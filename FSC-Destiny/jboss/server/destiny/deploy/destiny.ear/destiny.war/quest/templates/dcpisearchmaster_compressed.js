Class.create(BaseController,{init:function(){this.elementMap.get(DCPISearchController_DIV_MAIN_CENTER).hide();this.providers=null},registerEvents:function(){Event.observe(this.elementMap.get(SearchController_LINK_RESULTS_PREV),"mousedown",this.previousPage.bind(this));Event.observe(this.elementMap.get(SearchController_LINK_RESULTS_NEXT),"mousedown",this.nextPage.bind(this));Event.observe(this.elementMap.get(DCPISearchController_LINK_RESULTS_PREV),"mouseover",this.navigationHoverOver.bind(this,this.elementMap.get(DCPISearchController_LINK_SEARCH_RESULTS_PREV_PAGE),DCPISearchController_CLASS_PREV_HOVER));Event.observe(this.elementMap.get(DCPISearchController_LINK_RESULTS_PREV),"mouseout",this.navigationHoverOut.bind(this,this.elementMap.get(DCPISearchController_LINK_SEARCH_RESULTS_PREV_PAGE),DCPISearchController_CLASS_PREV_HOVER));Event.observe(this.elementMap.get(DCPISearchController_LINK_RESULTS_NEXT),"mouseover",this.navigationHoverOver.bind(this,this.elementMap.get(DCPISearchController_LINK_SEARCH_RESULTS_NEXT_PAGE),DCPISearchController_CLASS_NEXT_HOVER));
Event.observe(this.elementMap.get(DCPISearchController_LINK_RESULTS_NEXT),"mouseout",this.navigationHoverOut.bind(this,this.elementMap.get(DCPISearchController_LINK_SEARCH_RESULTS_NEXT_PAGE),DCPISearchController_CLASS_NEXT_HOVER))},submitNewSearch:function(c){window.ajaxTracker.abortAllRequests();this.search=c;var a=$(document.body);a.removeClassName("home");a.addClassName("search");this.elementMap.get(DCPISearchController_DIV_MAIN_CENTER).show();Registry.unregister("Top10Controller.Load");Registry.unregister("Top10Controller.Top10");Registry.unregister("NewArrivalsController.Loader");Registry.unregister("NewArrivalsController.Contents");Registry.unregister("PublicListsController.Load");Registry.unregister("LimiterController.Limiters");var d=Registry.lookup("VisualSearchController.VisualSearch");if(d&&Object.isFunction(d.hide)){d.hide()}Registry.lookup("LimiterController.History").reset();Registry.lookup("OneSearchController.SearchMaster").hide();Registry.lookup("SearchController.SearchMaster").hide();
this.show();var b=Registry.lookup("SearchTypeController.Selector");b.show();b.updateInternalSearchType(SearchTypeController_SEARCHTYPE_DCPI);this.showLoadingGraphic();if(DAO.load({endpoint:"DCPISearchController.SearchResults",container:this.elementMap.get(DCPISearchController_DIV_DCPI_SEARCH_RESULTS)},this.search.searchText,this.search.visualSearchNodeID,this.search.advancedSearchData,this.providers,this.providers&&this.providers.length==0)){Registry.unregister("DCPISearchController.SearchResults");this.showLoading()}else{this.hideLoadingGraphic()}},setSelectedProviders:function(c){var b=[];if(c){for(var a=0;a<c.length;a++){if(c[a].selected){b.push(c[a].id)}}}this.providers=b},setNextButtonVisible:function(b){var a=b?"inherit":"hidden";this.elementMap.get(DCPISearchController_LINK_RESULTS_NEXT).setStyle("visibility: "+a)},setPreviousButtonVisible:function(b){var a=b?"inherit":"hidden";this.elementMap.get(DCPISearchController_LINK_RESULTS_PREV).setStyle("visibility: "+a)},setPageIndex:function(a){this.elementMap.get(DCPISearchController_DIV_RESULTS_HEADER_X_OF_Y).update(a)
},navigationHoverOver:function(b,a){b.addClassName(a)},showLoadingGraphic:function(){this.showHeader();this.elementMap.get(DCPISearchController_DIV_RESULTS_LOADING).show();this.hideSearchResults()},hideLoadingGraphic:function(){this.isLoading=false;this.elementMap.get(DCPISearchController_DIV_RESULTS_LOADING).hide()},navigationHoverOut:function(b,a){b.removeClassName(a)},notifyPageDataUpdated:function(a){this.isFetching=false;if(this.isLoading){var b=Registry.lookup("DCPISearchController.SearchResults");b.setPage(a);this.isLoading=false}},fetchPage:function(d){this.isFetching=true;var b=Registry.lookup("SaveAdvancedSearch");var c=null;if(b){c=b.getLimiterJSON()}var a=Registry.lookup("LimiterController.Limiters.digitalResourceProvider");var e=null;if(a){e=a.getSelectedDigitalResourceProvidersIDs()}if(!DAO.load({endpoint:"DCPISearchController.SearchResultsPage",appendTo:"DCPISearchController.SearchResults"},this.search.searchText,this.search.visualSearchNodeID,d,c,e)){var f=this.fetchPage.bind(this,d);
f.delay(0.5)}},showLoading:function(){this.isLoading=true;this.setNextButtonVisible(false);this.setPreviousButtonVisible(false);this.setPageIndex(this.data.labels.pageIndexLoading)},prepareForRefresh:function(){this.showLoading();this.showLoadingGraphic();var a=Registry.lookup("DCPISearchController.SearchResults");a.clearData();this.elementMap.get(DCPISearchController_DIV_DCPI_SEARCH_RESULTS).update("")},nextPage:function(){if(!this.isFetching){var a=Registry.lookup("DCPISearchController.SearchResults");if(a){a.nextPage()}}else{this.showLoading()}},previousPage:function(){var a=Registry.lookup("DCPISearchController.SearchResults");if(a){a.previousPage()}},showHeader:function(){this.elementMap.get(DCPISearchController_DIV_RESULTS_HEADER_OUTER).show()},hideHeader:function(){this.elementMap.get(DCPISearchController_DIV_RESULTS_HEADER_OUTER).hide()},hideSearchResults:function(){this.elementMap.get(DCPISearchController_DIV_DCPI_SEARCH_RESULTS).hide()},showSearchResults:function(){this.elementMap.get(DCPISearchController_DIV_DCPI_SEARCH_RESULTS).show();
this.fixIERenderingIssue(DCPISearchController_DIV_DCPI_SEARCH_RESULTS)},removeSearchResultsStyleOnError:function(){this.elementMap.get(DCPISearchController_DIV_DCPI_SEARCH_RESULTS).removeClassName("searchResultsPage")},addSearchResultsStyleNoError:function(){this.elementMap.get(DCPISearchController_DIV_DCPI_SEARCH_RESULTS).addClassName("searchResultsPage")}});