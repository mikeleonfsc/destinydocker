Class.create(BaseController,{init:function(){if(this.modal&&Object.isElement(this.modal.contentDiv)){this.modal.show();this.shelfBrowsePreLoad()}},registerEvents:function(){Event.observe(this.elementMap.get(ShelfBrowseController_ID_SHELF_BROWSE_CLOSE),"mousedown",this.closeDialog.bind(this));Event.observe(this.elementMap.get(ShelfBrowseController_LINK_SHELF_BROWSE_NEXT),"mousedown",this.clickNext.bind(this));Event.observe(this.elementMap.get(ShelfBrowseController_LINK_SHELF_BROWSE_PREVIOUS),"mousedown",this.clickPrevious.bind(this))},closeDialog:function(){this.modal.closeDialog();this.hideControls();this.resetCarousel()},hideControls:function(){this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_CONTROLS).hide()},showControls:function(){this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_CONTROLS).show();var b=this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_SLIDER_CONTROL);var a=this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_SLIDER);this.slider=new Control.Slider(b,a,{onChange:this.drag.bind(this),onSlide:this.drag.bind(this),range:$R(0,this.data.shelfSize),sliderValue:this.data.currentIndex})
},hideLoading:function(){this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_LOADING).hide();this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_INNER_CONTENTS).show();this.modal.centerDialog()},showLoading:function(){this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_INNER_CONTENTS).hide();this.hideControls();this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_LOADING).show();this.modal.centerDialog()},shelfBrowsePreLoad:function(){this.showLoading();var d=Registry.lookup("TitleDetailsController.TitleDetails");if(d){var b=d.getCallNumber();var c=d.getCallNumberCopyID();var a=d.getMaterialType();DAO.load({endpoint:"ShelfBrowseController.ResultLoader"},b,c,a)}},clickNext:function(){this.cycleNext(true)},clickPrevious:function(){this.cyclePrevious(true)},_getRenderedComponent:function(c){var d=this.data.shelfData[c];var b={};var a=ReusableTemplates.load("HitListRecordTemplate",{record:d,currentID:"shelfBrowseRecord_"+c,options:b});return a},_removeRenderedComponent:function(a){var b=$("searchResult_shelfBrowseRecord_"+a);
if(b){b.remove()}},resetCarousel:function(){this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_INNER_CONTENTS).update("");this.data.shelfData=null;this.data.currentIndex=0;this.data.shelfSize=0},resetIndex:function(){this.data.currentIndex=this.data.originalStartIndex},addRecords:function(json){this.data.shelfData=json.results;this.data.originalStartIndex=eval(json.startingPoint);this.data.currentIndex=this.data.originalStartIndex;this.data.shelfSize=json.results.length},_loadTitleDetails:function(a){this.closeDialog();var b=Registry.lookup("TitleDetailsController.TitleDetails");if(b){b.closeDialog()}a()},_updateListeners:function(a){var e=Registry.lookup("TitleDetailsController.Master");for(var f=0;f<a.length;f++){var h=a[f];var i=this.data.shelfData[h];var b=i.bibID;var d=$(CoverImageTemplate_DIV_TITLE_IMAGE_PREFIX+"shelfBrowseRecord_"+h);var g=$(HitListRecordTemplate_DIV_TITLE_PREFIX+"shelfBrowseRecord_"+h);var c=e.loadTitleDetails.bind(e,b,null);if(Object.isElement(d)){Event.observe(d,"mousedown",this._loadTitleDetails.bind(this,c))
}if(Object.isElement(g)){Event.observe(g,"mousedown",this._loadTitleDetails.bind(this,c))}}},renderCarousel:function(){var f="";var e=5;if(e>this.data.shelfSize){e=this.data.shelfSize}var c=[];if(this.data.shelfSize>0){for(var a=0;a<e;a++){var d=this.data.currentIndex+a-2;while(d<0){d+=this.data.shelfSize}while(d>=this.data.shelfSize){d-=this.data.shelfSize}var b=this._getRenderedComponent(d);if(b){f+=b;c.push(d)}}}else{f=MessageHelper.format("shelfBrowseController_noTitlesFoundOnThisShelf")}this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_INNER_CONTENTS).innerHTML=f;this._updateListeners(c);if(this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_INNER_CONTENTS).visible){this.updateInfo()}},cycleNext:function(d){var a=this.data.currentIndex-2;if(a<0){a+=this.data.shelfSize}this._removeRenderedComponent(a);this.data.currentIndex++;if(this.data.currentIndex>=this.data.shelfSize){this.data.currentIndex-=this.data.shelfSize}var c=this.data.currentIndex+2;if(c>=this.data.shelfSize){c-=this.data.shelfSize
}var b=this._getRenderedComponent(c);this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_INNER_CONTENTS).insert(b);this._updateListeners([c]);if(d){this.updateSliderLocation()}},cyclePrevious:function(d){var a=this.data.currentIndex+2;if(a>=this.data.shelfSize){a-=this.data.shelfSize}this._removeRenderedComponent(a);this.data.currentIndex--;if(this.data.currentIndex<0){this.data.currentIndex+=this.data.shelfSize}var c=this.data.currentIndex-2;if(c<0){c+=this.data.shelfSize}var b=this._getRenderedComponent(c);this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_INNER_CONTENTS).insert({top:b});this._updateListeners([c]);if(d){this.updateSliderLocation()}},updateInfo:function(){if(this.data.shelfSize<=5){this.hideControls()}else{this.showControls()}this.updateSliderLocation()},updateSliderLocation:function(){if(this.slider){this.slider.setValue(this.data.currentIndex)}},drag:function(c){var d=this.elementMap.get(ShelfBrowseController_DIV_SHELF_BROWSE_SLIDER_CONTROL);var a=d.offsetLeft;
var e=this.data.currentIndex;var b=Math.round(c);if(e!=b){if(this.updateTimer){window.clearTimeout(this.updateTimer)}this.updateTimer=this.updateShelfOnDrag.bind(this).delay(0.02,e,b)}},updateShelfOnDrag:function(b,a){this.updateTimer=null;if(b+1==a){this.cycleNext(false)}else{if(b-1==a){this.cyclePrevious(false)}else{if(b!=a){this.data.currentIndex=a;this.renderCarousel()}}}}});