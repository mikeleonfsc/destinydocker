Class.create(BaseDestinyAutoCompleter,{initialize:function($super,c,f,e,b,a,d){this.errorDiv=e;this.inputField=b;$super(c,f,Object.extend({minChars:1,updateElement:this.myUpdateElement.bind(this)},d));this.loader=a;this.enable()},reEnableSaveForSafari:function(){this.dialog.autocompleter.saveEnabled=true},myUpdateElement:function(c){this.dialog=Registry.lookup("RecommendationController.RecommendationDialog");if(c){if(Object.isElement(c)){c=c.autocompleteIndex}var b=this.dialog.autocompleter.patronData[c];if(Prototype.Browser.WebKit>0){this.dialog.autocompleter.saveEnabled=false;var a=this.reEnableSaveForSafari.bind(this);a.delay(0.5)}else{this.dialog.autocompleter.saveEnabled=true}this.dialog.autocompleter.selectedPatron=b.patronID;this.dialog.autocompleter.selectedPatronName=b.patronName;this.dialog._selectPatron()}},onComplete:function(){this.ajaxInProgress=false;var b=this.data;this.patronData=$H(b.patronData);if(this.hasFocus){this.updateChoices(b.autocompleteDOM)}else{if(this.patronData&&this.patronData.size()>0){var a=this.patronData.keys()[0];
if(this.patronData.get(a).patronID>=0){this.myUpdateElement(a)}else{var c=$("addRecommendationError");c.update(MessageHelper.format("recommendationController_noMatchesFound"));c.show()}}}this.stopIndicator()},updateChoices:function(){if(!this.changed&&this.hasFocus){Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else{this.entryCount=0}this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},startIndicator:function($super){$super();this.ajaxInProgress=true;window.ajaxTracker.abortAllRequests()},stopIndicator:function($super){if(!this.ajaxInProgress){$super()
}},onKeyPress:function($super,a){if(!this.active&&a.keyCode==Event.KEY_RETURN){if(a){Event.stop(a)}this.inputField.activate()}else{$super(a)}},getUpdatedChoices:function($super){if(this.enabled&&this.oldElementValue!=this.element.value){this.startIndicator();this.loader()}},updateChoices:function(){if(!this.changed&&this.hasFocus){Element.cleanWhitespace(this.update);if(this.update.firstChild){Element.cleanWhitespace(this.update.down())}if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else{this.entryCount=0}this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}this.updated=false},getToken:function(){var a=this.getTokenBounds();return this.element.value.substring(a[0],a[1])},reset:function(){this.patronData=null;this.selectedPatron=null},enable:function(){this.enabled=true
},disable:function(){this.enabled=false}});