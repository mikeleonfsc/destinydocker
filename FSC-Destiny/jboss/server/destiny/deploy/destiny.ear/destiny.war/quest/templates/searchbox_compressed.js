Class.create(BaseController,{init:function(){if(this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT).value==MessageHelper.format("searchBoxController_enterYourSearchHere")){this.currentTextDefault=true}if(this.data.enableSearchSuggestionsInQuest){this.currentTextAutoComplete=new DestinyAutoCompleter("currentText","searchBoxSuggestions","SearchBoxController.AutoSuggest",SearchBoxController_AUTOSUGGEST_MIN_CHARS);this.currentTextAutoComplete.startMe()}},registerEvents:function(){Event.observe(this.elementMap.get(SearchBoxController_DIV_LOGIN_MODULE_OUTER),SearchBoxController_MODAL_CLOSE,this.returnHome.bind(this));Event.observe(this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT),"keydown",this.enterEvent.bind(this));Event.observe(this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT),"focus",this.textFocusListener.bind(this));Event.observe(this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT),"blur",this.textBlurListener.bind(this));Event.observe(this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT),"mousedown",this.textClickListener.bind(this));
Event.observe(this.elementMap.get(SearchBoxController_BUTTON_SUBMIT),"mousedown",this.submitSearchClick.bind(this));Event.observe(this.elementMap.get(SearchBoxController_FORM_ID_SEARCH_FORM),"submit",this.submitSearchSubmit.bindAsEventListener(this))},returnHome:function(){if(this.data.sslEnabled){window.location=this.data.httpRootURL}},enterEvent:function(){if(this.currentTextDefault){this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT).setValue("");this.currentTextDefault=false}},focusSearchBox:function(){this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT).activate()},textFocusListener:function(){var a=this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT);if(this.currentTextDefault&&a.hasClassName(SearchBoxController_CLASS_SEARCH_BOX_NO_INPUT)){a.setValue("");this.currentTextDefault=false;a.removeClassName(SearchBoxController_CLASS_SEARCH_BOX_NO_INPUT)}},textBlurListener:function(){var a=this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT);if(this.getSearchBoxText().empty()||this.currentTextDefault){a.setValue(MessageHelper.format("searchBoxController_enterYourSearchHere"));
a.addClassName(SearchBoxController_CLASS_SEARCH_BOX_NO_INPUT);this.currentTextDefault=true}},textClickListener:function(){var a=this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT);if(this.currentTextDefault){var b=a.setValue.bind(a,"");b.delay(0);this.currentTextDefault=false;a.removeClassName(SearchBoxController_CLASS_SEARCH_BOX_NO_INPUT)}},submitSearchSubmit:function(a){if(a){Event.stop(a)}this.submitSearchClick()},submitSearchClick:function(){Registry.unregister("SaveAdvancedSearch");var c=Registry.lookup("VisualSearchController.VisualSearch");if(c&&Object.isFunction(c.setVisualSearchNodeID)){c.setVisualSearchNodeID(null)}var b=this.submitSearch();if(b){var a=Registry.lookup("SearchTypeController.Selector");a.setSavedSearchText(b)}},disableAutoComplete:function(){if(this.currentTextAutoComplete){this.currentTextAutoComplete.disable();this.currentTextAutoComplete.hide()}},enableAutoComplete:function(){if(this.currentTextAutoComplete){this.currentTextAutoComplete.enable()}},submitSearch:function(f,j,a){var p=this.getSearchBoxText().empty()||this.currentTextDefault;
var o=this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT).disabled;var c=Registry.lookup("VisualSearchController.VisualSearch");var q=null;if(c&&Object.isFunction(c.getVisualSearchNodeID)){q=c.getVisualSearchNodeID()}var h=Registry.lookup("SearchTypeController.Selector");var m=h.getSearchType();var b=false;var d=Registry.lookup("SaveAdvancedSearch");if(d){b=m!=SearchTypeController_SEARCHTYPE_LIBRARY}var i;if(p){i=MessageHelper.format("searchBoxController_enterYourSearchHere")}if((!p&&!o)||j||b||q){this.disableAutoComplete();i=this.getSearchBoxText();Registry.unregister("MyQuestController.Loader");Registry.unregister("MyQuestController.Menu");if(m==SearchTypeController_SEARCHTYPE_ONESEARCH){var n=Registry.lookup("OneSearchController.SearchMaster");var k={searchText:i,resetOneSearchDatabases:false,visualSearchNodeID:q};n.submitNewSearch(k)}else{if(m==SearchTypeController_SEARCHTYPE_DCPI){var l=Registry.lookup("SearchController.SearchMaster");var k={searchText:i,advancedSearchData:a,visualSearchNodeID:q};
l.submitNewSearch(k)}else{var g=Registry.lookup("SearchController.SearchMaster");var k={searchText:i,searchType:m,pageNumber:0,sortBy:SearchController_SORTBYRELEVANCE,didYouMeanSearch:f,hiddenSearch:j,advancedSearchData:a,visualSearchNodeID:q,advancedServicesSearch:b};g.submitNewSearch(k)}}var e=Registry.lookup("QuestErrorController.GuestTimeout");if(e&&Object.isFunction(e.startTimeout)){e.startTimeout()}}else{this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT).removeClassName(SearchBoxController_CLASS_SEARCH_BOX_NO_INPUT);this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT).setValue(MessageHelper.format("searchBoxController_enterYourSearchHere"));this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT).activate();this.currentTextDefault=true}return i},showSuggestions:function(){if(this.currentTextAutoComplete){this.currentTextAutoComplete.updateChoices()}},getSearchBoxText:function(){var b=this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT).getValue();b=b.replace(/^\s+|\s+$/g,"");
var a=(this.currentTextDefault)?"":b;if(!a||!Object.isString(a)){a=""}return a},setSearchBoxText:function(a){this.elementMap.get(SearchBoxController_FIELD_CURRENT_TEXT).setValue(a);this.currentTextDefault=false}});