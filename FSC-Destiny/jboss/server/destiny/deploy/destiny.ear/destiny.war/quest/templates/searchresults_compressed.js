Class.create(BaseController,{init:function(){var e=Registry.lookup("QuestErrorController.Loader");if(e&&e.hasErrors()&&!e.sideWidgetsLoaded){e.sideWidgetsLoaded=true;PostLoadBootstrapper.load(["BooklistWidgetController.Load","MyQuestController.MyShelves"])}if(e&&e.messages){e.elementMap.get(QuestErrorController_DIV_ERROR_MESSAGE).update(e.messages);e.elementMap.get(QuestErrorController_DIV_ERROR_MESSAGE).show()}else{e.elementMap.get(QuestErrorController_DIV_ERROR_MESSAGE).update("");e.elementMap.get(QuestErrorController_DIV_ERROR_MESSAGE).hide()}var c=Registry.lookup("SearchController.SearchMaster");c.setNextButtonVisible(this.data.showNextButton);c.setPreviousButtonVisible(this.data.showPreviousButton);c.setPageIndex(this.data.pageIndex);c.hideLoadingGraphic();c.updateSortControl(this.data.sortType);if(this.data.warningMessage&&this.data.pageNumber===0){c.setWarningMessage(this.data.warningMessage)}else{c.hideWarningMessage()}if(Object.isArray(this.data.errors)&&this.data.errors.length>0){c.hideHeader()
}else{c.showHeader()}var h=Registry.lookup("SearchBoxController.SearchBox");h.enableAutoComplete();if(this.data.wpeHitList&&Object.isArray(this.data.wpeHitList.records)){this.isWPE=true}else{this.isWPE=false}this.hitList=(this.isWPE)?this.data.wpeHitList:this.data.hitList;var d=Registry.lookup("SearchTypeController.Selector");this.isDCPI=d.getSearchType()==SearchTypeController_SEARCHTYPE_DCPI;if(this.hitList){if(this.isWPE||this.isDCPI){c.hideSortControls()}else{c.showSortControls()}var f=this.isWPE;var g=Registry.lookup("HoverMasterController.HoverMaster");this.hoverGroup=g.createGroup({name:this.name,data:this.hitList.records,activatorContainer:this.container,hoverContainer:$("content-outer"),controllerURL:this.hitList.hoverControllerURL,templateURL:this.hitList.hoverTemplateURL,openDelay:0.5,closeDelay:0.1,onShow:function(){var i=g.lookupGroup("LimiterController.Limiters");if(i&&Object.isFunction(i.disable)){i.disable()}$("content-outer").addClassName("high-zindex");var k=Utility.downToClass($("resultsCacheInner"),"high-zindex");
if(k){k.removeClassName("high-zindex")}var j=Utility.upToClass(this.currentActivator,"searchResult");j.addClassName("high-zindex")},onHide:function(){var i=g.lookupGroup("LimiterController.Limiters");if(i&&Object.isFunction(i.enable)){i.enable()}$("content-outer").removeClassName("high-zindex")}});if(this.data.showNextButton&&!this.hasNextPage()){var b=c.fetchPage.bind(c,this.data.pageNumber+1,this.data.searchTerm,this.data.visualSearchNodeID,this.data.advancedSearchData);b.defer()}}if(this.isDCPI||this.hitList){if(this.data.limiters&&Object.isArray(this.data.limiters.limiterMenu)){Registry.createController("LimiterController.Limiters",this.data.limiterTemplateURL,this.data.limiterControllerURL,{endpoint:"LimiterController.Limiters",container:$(LimiterController_DIV_LIMITER_OUTER)},this.data.limiters);if(this.data.limiters.limiterData&&this.data.limiters.limiterData.length>0&&this.data.limiters.limiterData[0]&&this.data.limiters.limiterData[0].length>0&&this.data.limiters.limiterData[0][0].providers){c.setSelectedProviders(this.data.limiters.limiterData[0][0].providers)
}}}if(this.data.refreshLimiterHistory){var a=Registry.lookup("LimiterController.History");a.getNarrowingHistory()}Registry.lookup("SearchBoxController.SearchBox").focusSearchBox()},registerEvents:function(){var f=Registry.lookup("MyQuestController.MyShelves");var c=Registry.lookup("SearchController.SearchMaster");if(!this.isWPE&&this.hitList){var e=Registry.lookup("TitleDetailsController.Master");if(f){f.enableDroppables()}for(var b=0;b<this.hitList.records.length;b++){var d=this.isDCPI||this.hitList.records[b].dcpiRecordGUID||this.hitList.records[b].digitalMediaProviderName;var a=(d)?(this.hitList.records[b].follettEBookTitleDetailsURL)?(function(g){return function(){var h=window.open(g.follettEBookTitleDetailsURL,"shelfcontent_blank");if(h){h.focus()}}})(this.hitList.records[b]):c.dcpiRedirectorLoader.bind(c,this.hitList.records[b].dcpiRecordGUID||this.hitList.records[b].bibID,null,this.hitList.records[b].copySiteID,!!this.hitList.records[b].dcpiRecordGUID):e.loadTitleDetails.bind(e,this.hitList.records[b].bibID,null);
Event.observe(this.elementMap.get(HitListRecordTemplate_DIV_TITLE_PREFIX+b),"click",a);Event.observe(this.elementMap.get(CoverImageTemplate_DIV_TITLE_IMAGE_PREFIX+b),"click",a);this.addDraggable(CoverImageTemplate_DIV_TITLE_IMAGE_PREFIX+b,this.hitList.records[b].bibID,this.hitList.records[b].dcpiRecordGUID,null,false,d)}}else{if(this.hitList){if(f){f.disableDroppables()}for(var b=0;b<this.hitList.records.length;b++){this.addDraggable(CoverImageTemplate_DIV_TITLE_IMAGE_PREFIX+b,this.hitList.records[b].recID,null,null,true)}}}if(this.data.showMakeAWish){Event.observe(this.elementMap.get(SearchController_DIV_ADD_WISH_FROM_SEARCH_RESULTS_LINK),"mousedown",this.openWishDialog.bind(this))}if(Object.isArray(this.data.alternateTerms)){Event.observe(this.elementMap.get(SearchController_BUTTON_DID_YOU_MEAN_GO),"mousedown",this.submitDidYouMeanSearch.bind(this))}},openWishDialog:function(){var b={width:"512px",id:WishController_DIV_ADD_WISH_DIALOG,zIndex:"50000",hideOnOutsideClick:"true"};var a=new ModalDialog(b);
DAO.load({endpoint:"WishController.WishDialog",modal:a},null,null)},getSearchTerm:function(){return this.data.searchTerm},dataAppended:function(a){var b=Registry.lookup("SearchController.SearchMaster");b.notifyPageDataUpdated(a)},pagingAnimation:function(a,h,d,g){if(!Object.isElement(a)){this.container.update(h);g()}else{var c=a.getWidth();this.container.makePositioned();this.container.insert(h);var f=d?-1:1;if(window.isRTL){f=-f}a.setStyle({left:f*c+"px",width:c+"px",position:"absolute"});h.setStyle({width:c+"px"});this.container.setStyle({left:-f*c+"px"});var b=Registry.lookup("SearchController.SearchMaster");b.prepareSearchResultsForAnimation();var e=this.finishAnimation.bind(this,a,g);new Effect.Move(this.container,{x:f*c,mode:"relative",duration:1,afterFinish:e})}},finishAnimation:function(a,c){a.remove();var b=Registry.lookup("SearchController.SearchMaster");b.finishSearchResultsAnimation();c()},getCurrentSort:function(){var a=SearchController_SORTBYRELEVANCE;if(!$("SearchController_LINK_SORT_TITLE").visible()){a=SearchController_SORTBYTITLE
}return a},submitDidYouMeanSearch:function(){var b="";for(var a=0;a<5;a++){var d=this.elementMap.get("didYouMeanTerm"+a);if(d){if(a>0){b+=" "}b+=d.getValue()}}var c=Registry.lookup("SearchBoxController.SearchBox");c.setSearchBoxText(b);c.submitSearch(true)},updateSearchResults_DigitalResources:function(b,f,g){for(var e=this.pagedData.length-1;e>=0;e--){if(this.pagedData[e].hitList){var c=this.pagedData[e].hitList.records;for(var d=0;d<c.length;d++){var a=c[d];if(b&&b.indexOf(a.bibID)>=0){if(a.bibID!=null){a.inUsersBookList=g}}else{if(f&&f.indexOf(a.dcpiRecordGUID)>=0){if(a.dcpiRecordGUID!=null){a.inUsersBookList=g}}}}}}},updateSearchResults:function(IDs,listID,key,value,propertyToUpdate){for(var i=this.pagedData.length-1;i>=0;i--){if(eval("this.pagedData[i]."+listID)){var records=eval("this.pagedData[i]."+listID+".records;");for(var j=0;j<records.length;j++){var record=records[j];if(IDs.indexOf(eval(eval("record."+key)))>=0){record[propertyToUpdate]=value}}}}},updateStatusInfo:function(b,f,d,g){if(b){for(var e=0;
e<this.pagedData.length;e++){var a=this.pagedData[e].hitList.records;for(var c=0;c<a.length;c++){if(a[c].bibID==b){a[c].availabilityImageString=f;a[c].availabilityClass=d;a[c].hoverHighLevelAvailabilityLocalStatusString=g;jQuery("."+HitListRecordTemplate_CLASS_SEARCHRESULT+"."+HitListRecordTemplate_CLASS_BIBID_PREFIX+b+" ."+CoverImageTemplate_CLASS_RESULT_STATUS+" > img").replaceWith(a[c].availabilityImageString)}}}}}});