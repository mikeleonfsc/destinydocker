Class.create(BaseController,{init:function(){this.modal.show();this.bibID=this.data.bibID;if(this.bibID){this.elementMap.get(WishController_INPUT_ADD_WISH_CURRENT_TITLE).checked=true;this.elementMap.get(WishController_SPAN_ADD_WISH_DEFAULT_TITLE).addClassName(WishController_CLASS_ADD_WISH_SELECTED_WISH);this.elementMap.get(WishController_SPAN_ADD_WISH_ANOTHER_TITLE).removeClassName(WishController_CLASS_ADD_WISH_SELECTED_WISH)}else{this.elementMap.get(WishController_INPUT_ADD_WISH_ANOTHER_TITLE).checked=true;this.elementMap.get(WishController_DIV_ADD_WISH_TITLE_SELECTOR).hide();this.elementMap.get(WishController_DIV_ADD_WISH_DATA).show();var a=Registry.lookup("SearchController.SearchResults");if(a&&a.getSearchTerm()){this.elementMap.get(WishController_FIELD_WISH_TITLE).value=a.getSearchTerm()}}},registerEvents:function(){Event.observe(this.elementMap.get(WishController_BUTTON_ADD_WISH_CLOSE),"mousedown",this.closeDialog.bind(this));Event.observe(this.elementMap.get(WishController_INPUT_ADD_WISH_CURRENT_TITLE),"click",this.toggleSelectedTitle.bind(this,false));
Event.observe(this.elementMap.get(WishController_INPUT_ADD_WISH_ANOTHER_TITLE),"click",this.toggleSelectedTitle.bind(this,true));Event.observe(this.elementMap.get(WishController_BUTTON_ADD_WISH_SAVE),"click",this.addWish.bind(this))},populateErrors:function(b){var a=ReusableTemplates.load("GenericListTemplate",{list:b});this.elementMap.get(WishController_DIV_ADD_WISH_ERRORS).update(a);this.elementMap.get(WishController_DIV_ADD_WISH_ERRORS).show();this.elementMap.get(WishController_BUTTON_ADD_WISH_SAVE).disabled=false;this.elementMap.get(WishController_BUTTON_ADD_WISH_SAVE).blur()},addWish:function(d){this.elementMap.get(WishController_BUTTON_ADD_WISH_SAVE).disabled=true;var e=this.elementMap.get(WishController_FIELD_WISH_REASON).getValue();var b=false;if(this.elementMap.get(WishController_INPUT_ADD_WISH_CURRENT_TITLE).checked==true){b=DAO.load({endpoint:"WishController.WishGranter",container:null,method:"post"},this.bibID,null,null,null,e)}else{var f=this.elementMap.get(WishController_FIELD_WISH_TITLE).getValue();
var c=this.elementMap.get(WishController_FIELD_WISH_AUTHOR).getValue();var a=this.elementMap.get(WishController_FIELD_WISH_ISBN).getValue();b=DAO.load({endpoint:"WishController.WishGranter",container:null,method:"post"},null,f,c,a,e)}if(!b){this.elementMap.get(WishController_BUTTON_ADD_WISH_SAVE).disabled=false}},animateClose:function(a){this.modal.animatedSubmit(a)},closeDialog:function(a){this.modal.closeDialog()},toggleSelectedTitle:function(a){if(a){if(!this.elementMap.get(WishController_DIV_ADD_WISH_DATA).visible()){this.elementMap.get(WishController_INPUT_ADD_WISH_CURRENT_TITLE).disabled=true;this.elementMap.get(WishController_INPUT_ADD_WISH_ANOTHER_TITLE).disabled=true;Effect.BlindDown(this.elementMap.get(WishController_DIV_ADD_WISH_DATA),{duration:0.5,afterFinish:this.enableTitleSelector.bind(this)});this.elementMap.get(WishController_SPAN_ADD_WISH_ANOTHER_TITLE).addClassName(WishController_CLASS_ADD_WISH_SELECTED_WISH);this.elementMap.get(WishController_SPAN_ADD_WISH_DEFAULT_TITLE).removeClassName(WishController_CLASS_ADD_WISH_SELECTED_WISH)
}}else{if(this.elementMap.get(WishController_DIV_ADD_WISH_DATA).visible()){this.elementMap.get(WishController_INPUT_ADD_WISH_CURRENT_TITLE).disabled=true;this.elementMap.get(WishController_INPUT_ADD_WISH_ANOTHER_TITLE).disabled=true;Effect.BlindUp(this.elementMap.get(WishController_DIV_ADD_WISH_DATA),{duration:0.5,afterFinish:this.enableTitleSelector.bind(this)});this.elementMap.get(WishController_SPAN_ADD_WISH_DEFAULT_TITLE).addClassName(WishController_CLASS_ADD_WISH_SELECTED_WISH);this.elementMap.get(WishController_SPAN_ADD_WISH_ANOTHER_TITLE).removeClassName(WishController_CLASS_ADD_WISH_SELECTED_WISH)}}this.elementMap.get(WishController_DIV_ADD_WISH_ERRORS).hide()},enableTitleSelector:function(){this.elementMap.get(WishController_INPUT_ADD_WISH_ANOTHER_TITLE).disabled=false;this.elementMap.get(WishController_INPUT_ADD_WISH_CURRENT_TITLE).disabled=false}});