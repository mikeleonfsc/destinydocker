Class.create(BaseController,{init:function(){if(this.data.activeTab){this.setTab(this.data.activeTab)}else{this.setTab(TitleDetailsController_DIV_TITLE_DETAIL_TAB_ADDITIONALINFO)}if(!this.data.doNotShowDialog){this.modal.show()}var b=Registry.lookup("TitleDetailsController.TitleDetails");if(b){Registry.unregister("TitleDetailsController.TitleDetails")}if(this.data.canAddToBooklist){DAO.load({endpoint:"BooklistSelectController.TitleDetails",container:this.elementMap.get(BooklistSelectController_SELECT_LIST_CONTAINER)});var a=Registry.lookup("BooklistSelectController.TitleDetails");if(a){a.setBooklistValue(this.data.listID)}}},registerEvents:function(){Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_TAB_ADDITIONALINFO),"mousedown",this.setTab.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_TAB_ADDITIONALINFO));Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_TAB_REVIEWS),"mousedown",this.setTab.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_TAB_REVIEWS));
if(Object.isElement(this.elementMap.get(TitleDetailsController_LINK_TITLE_DETAIL_REVIEWS))){Event.observe(this.elementMap.get(TitleDetailsController_LINK_TITLE_DETAIL_REVIEWS),"mousedown",this.setTab.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_TAB_REVIEWS))}if(Object.isElement(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_MORE))){Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_MORE),"mousedown",this.titleDetailsShowMoreLessListener.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_MORE))}if(Object.isElement(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_LESS))){Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_LESS),"mousedown",this.titleDetailsShowMoreLessListener.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_LESS))}Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_CLOSE),"mousedown",this.closeDialog.bind(this));
Event.observe(this.modal.contentDiv,"modal:close",this.onClose.bind(this));if(this.data.canAccessBooklist){Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_ADD_TO_BOOKLIST),"mousedown",this.addTitleToBooklist.bind(this))}if(this.data.isOwningSite&&this.data.canSubmitReviews){if(!this.data.titleDetailValue.reviewForPatron){Event.observe(this.elementMap.get(TitleDetailsController_BUTTON_TITLE_DETAILS_ADD_REVIEW),"mousedown",this.openReviewDialog.bind(this))}}},closeDialog:function(){if(this.modal.visible){this.modal.closeDialog()}},onClose:function(){DAO.load({endpoint:"TitleDetailsController.TabSaver",container:null},this.data.activeTab);if(Registry.lookup("SearchTypeController.Selector").getSearchType()!=SearchTypeController_SEARCHTYPE_DCPI){Registry.lookup("SearchBoxController.SearchBox").focusSearchBox()}},setTab:function(d){this.data.activeTab=d;var a=this.elementMap.get(d);var e=this.elementMap.get(d+TitleDetailsController_DIV_TITLE_DETAIL_TAB_CONTENT);var c=[TitleDetailsController_DIV_TITLE_DETAIL_TAB_ADDITIONALINFO,TitleDetailsController_DIV_TITLE_DETAIL_TAB_REVIEWS];
c=c.without(d);for(var b=0;b<c.length;b++){this.elementMap.get(c[b]+TitleDetailsController_DIV_TITLE_DETAIL_TAB_CONTENT).hide();this.elementMap.get(c[b]).removeClassName("tabActive")}a.addClassName("tabActive");e.show()},addTitleToBooklist:function(){this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_ADD_TO_BOOKLIST).hide();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_IN_BOOKLIST).show();var b=SearchTypeController_SEARCHTYPE_DCPI;var a=DAO.load({endpoint:"BooklistWidgetController.BooklistBookAdder",container:null},null,this.data.titleDetailValue.recordGUID,b,this.data.titleDetailValue.copySiteID?this.data.titleDetailValue.copySiteID:null);if(!a){this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_ADD_TO_BOOKLIST).show();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_IN_BOOKLIST).hide()}},updateInUsersBooklist:function(c,b,a){if(b!=null&&this.data.bibID==b){this.data.titleDetailValue.inUsersBooklist=c;this.data.keywordSearchRecord.inUsersBookList=c
}else{if(a!=null&&this.data.dcpiRecordGUID==a){this.data.inUsersBooklist=c}}if(c){this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_ADD_TO_BOOKLIST).hide();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_IN_BOOKLIST).show()}else{this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_ADD_TO_BOOKLIST).show();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_IN_BOOKLIST).hide()}},openReviewDialog:function(){var b={width:"400px",id:ReviewController_DIV_ADD_REVIEW_DIALOG,zIndex:"50000",hideOnOutsideClick:"true"};var a=new ModalDialog(b);DAO.load({endpoint:"ReviewController.ReviewDialog",modal:a})},titleDetailsShowMoreLessListener:function(a){if(a==TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_MORE){this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_DATA).show();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_LESS).show();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_MORE).hide()
}else{if(a==TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_LESS){this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_DATA).hide();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_LESS).hide();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_MORE).show()}}},updateStatuses:function(a){this.elementMap.get("tdvAvailability").update(a.availabilityText);this.elementMap.get("localCopies").update(a.titleDetailValue.localAvailability);this.elementMap.get("offsiteCopies").update(a.titleDetailValue.offsiteAvailability);this.elementMap.get("imageAvailabilityDiv").update(a.availabilityImageDiv);this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_CONTROLS).removeClassName("statusIn");this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_CONTROLS).removeClassName("statusOut");this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_CONTROLS).removeClassName("statusAsk");
this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_CONTROLS).addClassName(a.classAvailability)},updateReviews:function(b,a){this.data.titleDetailValue.reviewInfo=b;this.data.titleDetailValue.reviewForPatron=a;this.refreshPage()},getTitle:function(){return this.data.titleDetailValue.title},getDCPIRecordGUID:function(){return this.data.dcpiRecordGUID}});