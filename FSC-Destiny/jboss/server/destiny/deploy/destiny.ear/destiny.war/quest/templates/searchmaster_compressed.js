Class.create(BaseController,{init:function(){this.elementMap.get(SearchController_DIV_MAIN_CENTER).hide();this.providers=null},registerEvents:function(){Event.observe(this.elementMap.get(SearchController_LINK_RESULTS_PREV),"mousedown",this.previousPage.bind(this));Event.observe(this.elementMap.get(SearchController_LINK_RESULTS_NEXT),"mousedown",this.nextPage.bind(this));Event.observe(this.elementMap.get(SearchController_LINK_SORT_RELEVANCE),"mousedown",this.changeSort.bind(this,SearchController_SORTBYRELEVANCE));Event.observe(this.elementMap.get(SearchController_LINK_SORT_TITLE),"mousedown",this.changeSort.bind(this,SearchController_SORTBYTITLE));Event.observe(this.elementMap.get(SearchController_LINK_RESULTS_PREV),"mouseover",this.navigationHoverOver.bind(this,this.elementMap.get(SearchController_LINK_SEARCH_RESULTS_PREV_PAGE),SearchController_CLASS_PREV_HOVER));Event.observe(this.elementMap.get(SearchController_LINK_RESULTS_PREV),"mouseout",this.navigationHoverOut.bind(this,this.elementMap.get(SearchController_LINK_SEARCH_RESULTS_PREV_PAGE),SearchController_CLASS_PREV_HOVER));
Event.observe(this.elementMap.get(SearchController_LINK_RESULTS_NEXT),"mouseover",this.navigationHoverOver.bind(this,this.elementMap.get(SearchController_LINK_SEARCH_RESULTS_NEXT_PAGE),SearchController_CLASS_NEXT_HOVER));Event.observe(this.elementMap.get(SearchController_LINK_RESULTS_NEXT),"mouseout",this.navigationHoverOut.bind(this,this.elementMap.get(SearchController_LINK_SEARCH_RESULTS_NEXT_PAGE),SearchController_CLASS_NEXT_HOVER))},submitNewSearch:function(c){if((c.searchText&&!c.searchText.empty())||c.advancedSearchData||c.visualSearchNodeID||c.advancedServicesSearch){window.ajaxTracker.abortAllRequests();Registry.unregister("Top10Controller.Load");Registry.unregister("Top10Controller.Top10");Registry.unregister("PublicListsController.Load");Registry.unregister("NewArrivalsController.Loader");Registry.unregister("NewArrivalsController.Contents");Registry.unregister("LimiterController.Limiters");var g=Registry.lookup("VisualSearchController.VisualSearch");if(g&&Object.isFunction(g.hide)){g.hide()
}var e=Registry.lookup("MyQuestController.Loader");if(e&&Object.isFunction(e.hide)){e.hide()}var b=Registry.lookup("MyQuestController.Menu");if(b&&Object.isFunction(b.hide)){b.hide()}var f=Registry.lookup("QuestErrorController.Loader");if(f&&Object.isFunction(f.clearMessages)){f.clearMessages()}Registry.lookup("LimiterController.History").reset();Registry.lookup("OneSearchController.SearchMaster").hide();this.show();this.elementMap.get(SearchController_DIV_MAIN_CENTER).show();this.elementMap.get(SearchController_DIV_RESULTS_HEADER_WARNING).hide();var d=Registry.lookup("SearchTypeController.Selector");d.show();if(c.visualSearchType==VisualSearchController_TYPE_ELEMENT_CATEGORY){d.hideWPE();d.hideOneSearch();d.hideDigitalResources()}else{d.showWPE();d.showOneSearch();d.showDigitalResources()}var a=$(document.body);a.removeClassName("home");a.removeClassName("bookClub");a.addClassName("search");if(d.getSearchType()==SearchTypeController_SEARCHTYPE_DCPI){if(DAO.load({endpoint:"DCPISearchController.SearchResults",container:this.elementMap.get(SearchController_DIV_RESULTS_CACHE_INNER)},c.searchText,c.visualSearchNodeID,c.advancedSearchData,this.providers,this.providers&&this.providers.length==0)){Registry.unregister("DCPISearchController.SearchResults");
Registry.unregister("SearchController.SearchResults");this.showLoading();this.showLoadingGraphic()}}else{if(DAO.load({endpoint:"SearchController.SearchResults",container:this.elementMap.get(SearchController_DIV_RESULTS_CACHE_INNER)},c.searchText,c.searchType,c.pageNumber,c.sortBy,c.didYouMeanSearch,c.hiddenSearch,c.advancedSearchData,c.visualSearchNodeID)){Registry.unregister("DCPISearchController.SearchResults");Registry.unregister("SearchController.SearchResults");this.showLoading();this.showLoadingGraphic()}}}},dcpiRedirectorLoader:function(d,b,c,a){var b="";if(b){b="&context="+b}this.openPopup("/cataloging/servlet/presentdcpiredirectform.do?"+((a)?"recordGUID=":"bibID=")+d+((a&&c)?("&dcpiSiteID="+c):"")+"&client=1"+b)},openPopup:function(a){window.open(a,"dcpicontent")},setSelectedProviders:function(c){var b=[];if(c){for(var a=0;a<c.length;a++){if(c[a].selected){b.push(c[a].id)}}}this.providers=b},changeSort:function(b){if(!this.isFetching&&!this.isLoading){var a=Registry.lookup("SearchTypeController.Selector");
if(DAO.load({endpoint:"SearchController.SearchResultsSort",appendTo:"SearchController.SearchResults"},b,a.getSearchType())){this.prepareForRefresh()}}},updateSortControl:function(a){if(a==SearchController_SORTBYTITLE){this.elementMap.get(SearchController_LINK_SORT_RELEVANCE).show();this.elementMap.get(SearchController_LINK_SORT_RELEVANCE+SearchController_DIV_SUFFIX_UNLINKED_CONTROL).hide();this.elementMap.get(SearchController_LINK_SORT_TITLE).hide();this.elementMap.get(SearchController_LINK_SORT_TITLE+SearchController_DIV_SUFFIX_UNLINKED_CONTROL).show()}else{this.elementMap.get(SearchController_LINK_SORT_RELEVANCE).hide();this.elementMap.get(SearchController_LINK_SORT_RELEVANCE+SearchController_DIV_SUFFIX_UNLINKED_CONTROL).show();this.elementMap.get(SearchController_LINK_SORT_TITLE).show();this.elementMap.get(SearchController_LINK_SORT_TITLE+SearchController_DIV_SUFFIX_UNLINKED_CONTROL).hide()}},prepareForRefresh:function(){this.showLoading();this.showLoadingGraphic();var a=Registry.lookup("SearchController.SearchResults");
a.clearData();this.elementMap.get(SearchController_DIV_RESULTS_CACHE_INNER).update("")},prepareForRefresh_DCPI:function(){this.showLoading();this.showLoadingGraphic();var a=Registry.lookup("DCPISearchController.SearchResults");a.clearData();this.elementMap.get(SearchController_DIV_RESULTS_CACHE_INNER).update("")},notifyPageDataUpdated:function(a){this.isFetching=false;if(this.isLoading){var c=Registry.lookup("SearchTypeController.Selector");var b=(c.getSearchType()==SearchTypeController_SEARCHTYPE_DCPI)?Registry.lookup("DCPISearchController.SearchResults"):Registry.lookup("SearchController.SearchResults");b.setPage(a);this.isLoading=false}},fetchPage:function(b,c,f,a){this.isFetching=true;var d=Registry.lookup("SearchTypeController.Selector");if(d.getSearchType()==SearchTypeController_SEARCHTYPE_DCPI){if(!DAO.load({endpoint:"DCPISearchController.SearchResultsPage",appendTo:"DCPISearchController.SearchResults"},c,f,b,a,this.providers,this.providers&&this.providers.length==0)){var e=this.fetchPage.bind(this,b);
e.delay(0.5)}}else{if(!DAO.load({endpoint:"SearchController.SearchResultsPage",appendTo:"SearchController.SearchResults"},b,d.getSearchType())){var e=this.fetchPage.bind(this,b);e.delay(0.5)}}},nextPage:function(){if(!this.isFetching){var b=Registry.lookup("SearchTypeController.Selector");var a=null;if(b.getSearchType()==SearchTypeController_SEARCHTYPE_DCPI){a=Registry.lookup("DCPISearchController.SearchResults")}else{a=Registry.lookup("SearchController.SearchResults")}if(a){this.hideSortControls();a.nextPage()}}else{this.showLoading()}},showLoading:function(){this.isLoading=true;this.setNextButtonVisible(false);this.setPreviousButtonVisible(false);this.hideSortControls();this.setPageIndex(MessageHelper.format("searchController_loading"))},previousPage:function(){var b=Registry.lookup("SearchTypeController.Selector");var a=null;if(b.getSearchType()==SearchTypeController_SEARCHTYPE_DCPI){a=Registry.lookup("DCPISearchController.SearchResults")}else{a=Registry.lookup("SearchController.SearchResults")
}if(a){this.hideSortControls();a.previousPage()}},setWarningMessage:function(a){this.elementMap.get(SearchController_DIV_RESULTS_HEADER_WARNING).update(a);this.elementMap.get(SearchController_DIV_RESULTS_HEADER_WARNING).show()},hideWarningMessage:function(){this.elementMap.get(SearchController_DIV_RESULTS_HEADER_WARNING).hide()},showWarningMessage:function(){this.elementMap.get(SearchController_DIV_RESULTS_HEADER_WARNING).show()},setNextButtonVisible:function(b){var a=b?"inherit":"hidden";this.elementMap.get(SearchController_LINK_RESULTS_NEXT).setStyle("visibility: "+a)},setPreviousButtonVisible:function(b){var a=b?"inherit":"hidden";this.elementMap.get(SearchController_LINK_RESULTS_PREV).setStyle("visibility: "+a)},setPageIndex:function(a){this.elementMap.get(SearchController_DIV_RESULTS_HEADER_X_OF_Y).update(a)},prepareSearchResultsForAnimation:function(){this.elementMap.get(SearchController_DIV_RESULTS_CACHE).addClassName("searchResultsAnimation")},finishSearchResultsAnimation:function(){this.elementMap.get(SearchController_DIV_RESULTS_CACHE).removeClassName("searchResultsAnimation")
},showLoadingGraphic:function(){this.elementMap.get(SearchController_DIV_RESULTS_LOADING).show()},hideLoadingGraphic:function(){this.isLoading=false;this.elementMap.get(SearchController_DIV_RESULTS_LOADING).hide()},navigationHoverOver:function(b,a){b.addClassName(a)},navigationHoverOut:function(b,a){b.removeClassName(a)},showHeader:function(){this.elementMap.get(SearchController_DIV_RESULTS_HEADER_OUTER).show()},hideHeader:function(){this.elementMap.get(SearchController_DIV_RESULTS_HEADER_OUTER).hide()},showSortControls:function(){this.elementMap.get(SearchController_DIV_RESULTS_HEADER_SORT).show()},hideSortControls:function(){this.elementMap.get(SearchController_DIV_RESULTS_HEADER_SORT).hide()}});