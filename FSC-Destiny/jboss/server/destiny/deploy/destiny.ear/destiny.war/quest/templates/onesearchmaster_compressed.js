Class.create(BaseController,{init:function(){this.pollingPeriodSec=this.data.pollingPeriod/1000;this.maxPollingCount=this.data.maxPollingCount;this.currentRefreshCount=0},registerEvents:function(){},submitNewSearch:function(c){window.ajaxTracker.abortAllRequests();var a=$(document.body);a.removeClassName("home");a.removeClassName("bookClub");a.addClassName("search");this.elementMap.get(OneSearchController_DIV_ONESEARCH_MAIN).show();Registry.unregister("Top10Controller.Load");Registry.unregister("Top10Controller.Top10");Registry.unregister("NewArrivalsController.Loader");Registry.unregister("NewArrivalsController.Contents");Registry.unregister("PublicListsController.Load");Registry.unregister("LimiterController.Limiters");var d=Registry.lookup("VisualSearchController.VisualSearch");if(d&&Object.isFunction(d.hide)){d.hide()}Registry.lookup("LimiterController.History").reset();Registry.lookup("SearchController.SearchMaster").hide();this.show();this.elementMap.get(OneSearchController_DIV_ONESEARCH_WARNING).show();
$(SearchController_DIV_HEADER_INNER_GROUP1).show();var b=Registry.lookup("SearchTypeController.Selector");b.show();b.updateInternalSearchType(SearchTypeController_SEARCHTYPE_ONESEARCH);this.clearRefreshTimer();if(DAO.load({endpoint:"OneSearchController.SearchResults",container:this.elementMap.get(OneSearchController_DIV_ONESEARCH_DB_HITS)},c.searchText,c.resetOneSearchDatabases,c.visualSearchNodeID)){Registry.unregister("OneSearchController.SearchResults");this.elementMap.get(OneSearchController_DIV_ONESEARCH_WARNING).hide();this.elementMap.get(OneSearchController_DIV_ONESEARCH_DB_COUNTS).hide();this.elementMap.get(OneSearchController_DIV_ONESEARCH_DB_PROGRESS).show()}},clearRefreshTimer:function(){this.currentRefreshCount=0;if(this.currentRefreshID){window.clearTimeout(this.currentRefreshID)}},startRefreshTimer:function(){var a=this.fetchMoreResults.bind(this);if(this.currentRefreshCount<this.maxPollingCount){var b=this.pollingPeriodSec;if(this.currentRefreshCount>=(this.maxPollingCount/2)){b=b*2
}this.currentRefreshID=a.delay(b)}else{this.hideLoadingGraphic()}},fetchMoreResults:function(){DAO.load({endpoint:"OneSearchController.SearchResultsUpdater",appendTo:"OneSearchController.SearchResults"})},hideLoadingGraphic:function(){this.elementMap.get(OneSearchController_DIV_ONESEARCH_DB_PROGRESS).hide()},setWarningMessage:function(a){this.elementMap.get(OneSearchController_DIV_ONESEARCH_WARNING).update(a);this.elementMap.get(OneSearchController_DIV_ONESEARCH_WARNING).show()},prepareForRefresh:function(){this.elementMap.get(OneSearchController_DIV_ONESEARCH_DB_HITS).update("");this.elementMap.get(OneSearchController_DIV_ONESEARCH_WARNING).hide();this.elementMap.get(OneSearchController_DIV_ONESEARCH_DB_COUNTS).hide();this.elementMap.get(OneSearchController_DIV_ONESEARCH_DB_PROGRESS).show();var a=Registry.lookup("OneSearchController.SearchResults");a.clearData()},setErrorMessage:function(a){this.elementMap.get(OneSearchController_DIV_ONESEARCH_DB_PROGRESS).hide();this.elementMap.get(OneSearchController_DIV_ONESEARCH_DB_HITS).update("");
this.setCountMessage(a)},setCountMessage:function(a){this.elementMap.get(OneSearchController_DIV_ONESEARCH_DB_COUNTS).show();this.elementMap.get(OneSearchController_DIV_ONESEARCH_DB_COUNTS).update(a)}});