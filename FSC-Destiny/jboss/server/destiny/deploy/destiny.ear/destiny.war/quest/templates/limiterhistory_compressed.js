Class.create(BaseController,{init:function(){this.narrowNav=this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_NAV);this.overflowNav=this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_NAV_PREVIOUS_ALL);this.overflowMenu=this.elementMap.get(LimiterController_LI_NARROWING_HISTORY_NAV_PREVIOUS);this.reset(true)},registerEvents:function(){Event.observe(this.elementMap.get(LimiterController_LINK_NARROWING_HISTORY_NAV_PREVIOUS),"mousedown",this.showOverflowMenu.bind(this));Event.observe(this.elementMap.get(LimiterController_LINK_NARROWING_HISTORY_NAV_PREVIOUS),"mouseover",this.clearHideOverflowMenuTimeout.bind(this));Event.observe(this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_PREVIOUS_DROP_DOWN),"mouseover",this.clearHideOverflowMenuTimeout.bind(this));Event.observe(this.elementMap.get(LimiterController_LINK_NARROWING_HISTORY_NAV_PREVIOUS),"mouseout",this.delayHideOverflowMenu.bind(this));Event.observe(this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_PREVIOUS_DROP_DOWN),"mouseout",this.delayHideOverflowMenu.bind(this))
},showOverflowMenu:function(){if(Object.isElement(this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_PREVIOUS_DROP_DOWN))){new Effect.BlindDown(this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_PREVIOUS_DROP_DOWN),{duration:0.25})}},clearHideOverflowMenuTimeout:function(){if(this.hideTimeout){window.clearTimeout(this.hideTimeout)}},delayHideOverflowMenu:function(){if(this.hideTimeout){window.clearTimeout(this.hideTimeout)}var a=this.hideOverflowMenu.bind(this);this.hideTimeout=a.delay(1.5)},hideOverflowMenu:function(){var a=this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_PREVIOUS_DROP_DOWN);if(Object.isElement(a)&&a.visible()){new Effect.BlindUp(a,{duration:0.25})}},getNarrowingHistory:function(){var b=Registry.lookup("MenuBarController.MenuData");var a=Registry.lookup("SearchTypeController.Selector");DAO.load({endpoint:"LimiterController.HistoryElement",container:this.elementMap.get(LimiterController_DIV_LIMITER_HISTORY_HOLDING_TANK)},b.getViewMode(),a.getSearchType())
},deleteHistoryElement:function(d){var a=this.deleteHistory(d);if(a>0){if(Object.isElement(this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_PREVIOUS_DROP_DOWN))){this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_PREVIOUS_DROP_DOWN).hide()}var b=Registry.lookup("SearchTypeController.Selector");if(DAO.load({endpoint:"LimiterController.HistoryElementDeleter",appendTo:"SearchController.SearchResults"},a-1,b.getSearchType())){var c=Registry.lookup("SearchController.SearchMaster");c.prepareForRefresh()}}},notifyHistoryLoaded:function(c){var e=this.elementMap.get(LimiterController_DIV_LIMITER_HISTORY_HOLDING_TANK).immediateDescendants();if(Object.isArray(e)){for(var b=0;b<e.length;b++){var a=e[b];var d=a.clone(true);a.remove();this.addUpdate(d,c.indexToPrint);if(c.indexToPrint>0){Event.observe(d,"mousedown",this.deleteHistoryElement.bind(this,d))}}}},addUpdate:function(e,g){var b=this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_NAV);var h=this.elementMap.get(LimiterController_LI_NARROWING_HISTORY_NAV_PREVIOUS);
var f=this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_NAV_PREVIOUS_ALL);this.removeElement(g);if(g==0){this.reset();h.remove();b.insert(e);var i=b.childElements();i[0].insert({after:h})}else{b.insert(e)}var i=b.childElements();if(i&&i.length>0){if(g==0&&i.length==3){var a=i[1];this.internalList[this.internalList.length]=a}var a=i[i.length-1];this.internalList[this.internalList.length]=a;if(this.internalList.length>3){var d=this.internalList[1];this.overflowList[this.overflowList.length]=d;this.internalList=this.internalList.without(d);d.remove();this.overflowNav.insert(d);var c=Utility.downToClass(d,"narrowNavFirstLevel");if(c){c.removeClassName("narrowNavFirstLevel");c.addClassName("narrowNavSecondLevel")}h.show()}}},removeElement:function(a){if(a>0){if(a-1<this.overflowList.length){var b=this.overflowList[a-1];Element.remove.delay(0,b);this.overflowList=this.overflowList.without(b)}else{var c=a-this.overflowList.length;if(this.internalList[c]){var b=this.internalList[c];Element.remove.delay(0,b);
this.internalList=this.internalList.without(b)}}}},reset:function(a){this.internalList=new Array();this.overflowList=new Array();var b=this.overflowMenu;if(b){b.remove()}if(this.narrowNav){this.narrowNav.update("");if(b){this.narrowNav.insert(b);this.overflowMenu=b}}if(this.overflowNav){this.overflowNav.update("")}if(Object.isElement(this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_PREVIOUS_DROP_DOWN))){this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_PREVIOUS_DROP_DOWN).hide()}if(this.overflowMenu){this.overflowMenu.hide()}if(a){this.hide()}else{this.show()}},hide:function(){$(SearchController_DIV_HEADER_INNER_GROUP1).hide()},show:function(){$(SearchController_DIV_HEADER_INNER_GROUP1).show()},deleteHistory:function(d){var a=-1;if(d!=this.overflowMenu){if(d.id!="narrowNavTerm"){a=this.overflowList.indexOf(d);var e=false;if(a==-1){a=this.internalList.indexOf(d);a+=this.overflowList.length;e=true}else{if(this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_PREVIOUS_DROP_DOWN)){this.elementMap.get(LimiterController_DIV_NARROWING_HISTORY_PREVIOUS_DROP_DOWN).hide()
}a+=1}}if(a!=-1){this.removeElement(a);if(e){if(this.overflowList.length>0){var f=this.overflowList[this.overflowList.length-1];this.overflowList=this.overflowList.without(f);this.internalList[this.internalList.length]=f;var b=this.internalList.length-1;while(b>1){this.internalList[b]=this.internalList[b-1];this.internalList[b-1]=f;b--}f.remove();this.internalList[0].insert({after:f});var c=Utility.downToClass(f,"narrowNavSecondLevel");if(c){c.removeClassName("narrowNavSecondLevel");c.addClassName("narrowNavFirstLevel")}}}if(this.overflowList.length==0){this.overflowMenu.hide()}}}return a}});