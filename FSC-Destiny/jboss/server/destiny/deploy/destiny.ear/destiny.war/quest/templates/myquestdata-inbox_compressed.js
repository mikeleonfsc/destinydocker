Class.create(BaseController,{init:function(){var b=Registry.lookup("MyQuestController.Loader");$("searchtemplate").removeClassName("home");$("searchtemplate").removeClassName("search");$("searchtemplate").addClassName("bookClub");var d=this.data;this.menu=Registry.lookup("MyQuestController.Menu");if(d.inboxCount>=0){this.menu.updateInboxCount(d.inboxCount)}var c=this.template.render(d);b.updateContent(c);this.shelfSelect=new ShelfSelect({id:"myQuestMainContent"});var h=$("myQuestMainContentWrapper");this.updatesList=null;if(d.mapping==MyQuestController_MAPPING_INBOX){$("myQuestMainContentWrapper").className="myQuestInbox"}var a=d.todayStr;if(h.hasClassName("myQuestInbox")){this.updatesList=new MyQuestList({resultsDivID:"myQuestMainContent",rowClass:"myQuestItem",todayStr:a,emptyStr:MessageHelper.format("myQuestUpdatesController_youHaveNoUpdates")})}h.show();this.currentMode=d.mapping;this.records=[];for(i=0;i<this.data.data.dateGroups.length;i++){var e=this.data.data.dateGroups[i];for(j=0;
j<e.items.length;j++){var f=e.items[j];this.records.push(f)}}var g=Registry.lookup("HoverMasterController.HoverMaster");this.hoverGroup=g.createGroup({name:this.name,data:this.records,activatorContainer:this.container,hoverContainer:$("content-outer"),controllerURL:this.data.hoverControllerURL,templateURL:this.data.hoverTemplateURL,openDelay:0.5,closeDelay:0.1,onShow:function(p,o){var m=p.up("#myQuestMainContent");if(Object.isElement(m)){var l=m.select(".high-zindex");if(Object.isArray(l)){for(i=0;i<l.length;i++){if(Object.isElement(l[i])){l[i].removeClassName("high-zindex")}}}}var k=p.up(".myQuestItem");if(Object.isElement(k)){k.addClassName("high-zindex")}var n=p.up("."+MyQuestController_CLASS_MYQUEST_DATE_GROUP);if(Object.isElement(n)){n.addClassName("high-zindex")}$("content-outer").addClassName("high-zindex")},onHide:function(n,m){var k=n.up(".myQuestItem");if(Object.isElement(k)){k.removeClassName("high-zindex")}var l=n.up("."+MyQuestController_CLASS_MYQUEST_DATE_GROUP);if(Object.isElement(l)){l.removeClassName("high-zindex")
}$("content-outer").removeClassName("high-zindex")}})},registerEvents:function(){if($("myQuestUpdatesResults")){Event.stopObserving("myQuestUpdatesResults");Event.observe("myQuestUpdatesResults","click",this.doReportAbuse.bindAsEventListener(this))}Event.stopObserving("myQuestMainContent");Event.observe("myQuestMainContent","mousedown",this.determineAction.bindAsEventListener(this));Event.stopObserving("myQuestFooter");Event.observe("myQuestFooter","click",this.loadOlderOrNewerResults.bindAsEventListener(this));for(i=0;i<this.data.data.dateGroups.length;i++){var d=this.data.data.dateGroups[i];for(j=0;j<d.items.length;j++){var c=d.items[j];var b=$("titleDetailLink_"+c.auditID);var e=Registry.lookup("TitleDetailsController.Master");var a=e.loadTitleDetails.bind(e,c.bibID,null);if(b){Event.observe("titleDetailLink_"+c.auditID,"mousedown",a)}}}},doReportAbuse:function(c){var e=Event.element(c);if(e.hasClassName(MyQuestUpdatesController_CLASS_MYQUEST_REPORT_ABUSE)){var h=Utility.upToClass(e,"myQuestUpdatesItem");
if(h){var a=Utility.downToClass(h,"currentID").readAttribute("value");var d=Utility.downToClass(h,"conversationID").readAttribute("value")}else{h=Utility.upToClass(e,"myQuestShelfItem");var g=h.getAttribute("rowid")}var f={width:"610",id:ReportAbuseController_DIV_REPORT_ABUSE_DIALOG,zIndex:"50000",hideOnOutsideClick:"true"};var b=new ModalDialog(f);DAO.load({endpoint:"ReportAbuseController.ReportAbuseDialog",modal:b},d,g)}},loadOlderOrNewerResults:function(b){var c=Event.element(b);var d=ReusableTemplates.load("EmptyImageTemplate",{id:"loading",styleClass:"loading",altText:"loading_string"});if(c.hasClassName("myQuestLaterPostControlLink")){var a=$("updatesOffsetPrev").innerHTML;$("myQuestMainContent").innerHTML=d;DAO.load({endpoint:"MyQuestInboxController.Loader",container:$(MyQuestController_DIV_MYQUEST_MAIN_CONTENT)},null,a)}else{if(c.hasClassName("myQuestEarlierPostControlLink")){var a=$("updatesOffsetNext").innerHTML;$("myQuestMainContent").innerHTML=d;DAO.load({endpoint:"MyQuestInboxController.Loader",container:$(MyQuestController_DIV_MYQUEST_MAIN_CONTENT)},null,a)
}}},determineAction:function(b){if($("myQuestMainContentWrapper").className!="myQuestFriends"){var d=Event.element(b);var e=b.target.up(".myQuestFriendsItem");if(e){var a=e.getAttribute("rowid");if(d.hasClassName("myQuestControlDecline")){e.down(".myQuestControlWrapper").hide();DAO.load({endpoint:"MyQuestFriendsController.RemoveFriend",container:null},a,this.getCurrentMode())}else{if(d.hasClassName("myQuestControlAccept")){e.down(".myQuestControlWrapper").hide();DAO.load({endpoint:"MyQuestFriendsController.AddFriend",container:null},a,this.getCurrentMode())}}}if(d.hasClassName("myQuestRecommendationRemove")){var e=b.target.up(".myQuestShelfItem");e.down(".myQuestShelfControlWrapper").hide();e.down(".myQuestRecommendationRemove").hide();var c=e.getAttribute("rowid");DAO.load({endpoint:"MyQuestUpdatesController.RecommendationRemove",container:null},c)}}},removeFriendCallback:function(a){if(this.updatesList){this.updatesList.removeRow(a.userID,null,function(){var b=MyQuestFriendsController_MAPPING_INBOX;
var c=$(MyQuestController_DIV_MYQUEST_MAIN_CONTENT_WRAPPER);c.fire(MyQuestFriendsController_EVENT_MYQUEST_OPTION_CLICK,{mapping:b})})}if(a.inboxCount>=0){$(MyQuestController_SPAN_MYQUEST_LEFT_INBOX_COUNT).update(a.inboxCount)}},addFriendCallback:function(a){if(this.updatesList){var b=$$(".myQuestItem[rowid="+a.userID+"] > .column2 > .myQuestFriendsFullName > .myQuestPatronName")[0].innerHTML;this.updatesList.removeRow(a.userID,MessageHelper.format("myQuestInboxController_someoneHasBeenAddedToYourFriends",b),this.refreshUpdatesOrInbox.bind(this))}if(a.inboxCount>=0){var c=Registry.lookup("MyQuestController.Menu");$(MyQuestController_SPAN_MYQUEST_LEFT_INBOX_COUNT).update(a.inboxCount)}},removeRecommendationCallback:function(a){if(this.updatesList){this.updatesList.removeRow(a.recommendationID,null,this.refreshUpdatesOrInbox.bind(this))}if(a.inboxCount>=0){var b=Registry.lookup("MyQuestController.Menu");$(MyQuestController_SPAN_MYQUEST_LEFT_INBOX_COUNT).update(a.inboxCount)}},refreshUpdatesOrInbox:function(){var a=$(MyQuestController_DIV_MYQUEST_MAIN_CONTENT_WRAPPER);
DAO.load({endpoint:"MyQuestInboxController.Loader",container:$(MyQuestController_DIV_MYQUEST_MAIN_CONTENT)},this.data.numResultsForPage,this.data.updatesOffset)},getCurrentMode:function(){return this.currentMode},updateResults:function(IDs,key,value,propertyToUpdate){var records=this.records;for(var j=0;j<records.length;j++){var record=records[j];if(IDs.indexOf(eval("record."+key))>=0){record[propertyToUpdate]=value}}}});