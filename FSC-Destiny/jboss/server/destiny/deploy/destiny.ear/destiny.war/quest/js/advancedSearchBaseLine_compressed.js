Class.create({initialize:function(a){this.advancedSearch=a;this._buildElement()},_buildElement:function(){this.element=Builder.node("div",{"class":"advSearch-FilterRow"});var f=Builder.node("p",{"class":"column column-1"});this.element.insert(f);var a=Builder.node("span",{"class":"label"},this.getLabel());f.insert(a);this.type=this._buildSelectNode();var d=this.fireUpdateEvent.bindAsEventListener(this);Event.observe(this.type,"change",d);a.insert(this.type);this.setType(AdvancedSearchController_AS_SEARCH_TYPE_KEYWORD);this.element.insert(this.getColumnTwoNode());var c=Builder.node("p",{"class":"column column-3"});this.element.insert(c);this.removeRow=Builder.node("a",{"class":"advSearch-RemoveFilterRow",href:"#",alt:MessageHelper.format("advancedSearchDataValue_removeThisSearchFilter"),title:MessageHelper.format("advancedSearchDataValue_removeThisSearchFilter")},[Builder.node("em",{},MessageHelper.format("advancedSearchDataValue_removeLimiter"))]);c.insert(this.removeRow);c.insert(Builder.node("span",{}," "));
this.addRow=Builder.node("a",{"class":"advSearch-AddFilterRow",href:"#",alt:MessageHelper.format("advancedSearchDataValue_addASearchFilter"),title:MessageHelper.format("advancedSearchDataValue_addASearchFilter")},[Builder.node("em",{},MessageHelper.format("advancedSearchDataValue_addLimiter"))]);c.insert(this.addRow);if(this.advancedSearch){var e=this.advancedSearch.addLine.bind(this.advancedSearch,this.getLineType());Event.observe(this.addRow,"click",e);var b=this.advancedSearch.removeLine.bindAsEventListener(this.advancedSearch,this.getLineType());Event.observe(this.removeRow,"click",b)}},_buildSelectNode:function(){return Builder.node("select",{},[Builder.node("option",{value:AdvancedSearchController_AS_SEARCH_TYPE_KEYWORD},MessageHelper.format("advancedSearchDataValue_keywords")),Builder.node("option",{value:AdvancedSearchController_AS_SEARCH_TYPE_TITLE},MessageHelper.format("advancedSearchDataValue_titles")),Builder.node("option",{value:AdvancedSearchController_AS_SEARCH_TYPE_AUTHOR},MessageHelper.format("advancedSearchDataValue_authors")),Builder.node("option",{value:AdvancedSearchController_AS_SEARCH_TYPE_NOTE},MessageHelper.format("advancedSearchDataValue_notes")),Builder.node("option",{value:AdvancedSearchController_AS_SEARCH_TYPE_SERIES},MessageHelper.format("advancedSearchDataValue_series")),Builder.node("option",{value:AdvancedSearchController_AS_SEARCH_TYPE_SUBJECT},MessageHelper.format("advancedSearchDataValue_subjects"))])
},hideAddRow:function(){this.addRow.setStyle({visibility:"hidden"})},showAddRow:function(){this.addRow.setStyle({visibility:"visible"})},getColumnTwoNode:function(){var b=Builder.node("p",{"class":"column column-2"});this.textInput=Builder.node("input",{maxlength:"100"});var a=this.fireUpdateEvent.bindAsEventListener(this);Event.observe(this.textInput,"keyup",a);b.insert(this.textInput);return b},getElement:function(){return this.element},setValue:function(a){if(this.textInput){this.textInput.setValue(a)}},getValue:function(){if(this.textInput){return this.textInput.getValue().escapeHTML()}},setType:function(a){if(this.type){this.type.setValue(a)}},getType:function(){if(this.type){return this.type.getValue()}},getQueryString:function(b){var a=this.getValue();return a},fireUpdateEvent:function(c){if(this.advancedSearch){var a={};var b;if(c&&c.type=="keyup"){b=true}this.advancedSearch.doUpdate(b)}},lowerBooleans:function(c){var b=[{pattern:/\s+AND\s+/g,replacement:" and "},{pattern:/\s+OR\s+/g,replacement:" or "},{pattern:/\s+NOT\s+/g,replacement:" not "}];
for(var a=0;a<b.size();a++){c=c.replace(b[a].pattern,b[a].replacement)}return c},focus:function(){this.textInput.focus()},buildDQLComponent:function(c,d,b){var a="";if(d==AdvancedSearchController_AS_QUERY_OUTPUT_SERVICES){a=c}else{if(!c.strip().empty()){switch(this.getType()){case AdvancedSearchController_AS_SEARCH_TYPE_TITLE:a=this.highlightProperty(AdvancedSearchController_DQL_FIELD_TITLE,c,d,b);break;case AdvancedSearchController_AS_SEARCH_TYPE_AUTHOR:a=this.highlightProperty(AdvancedSearchController_DQL_FIELD_AUTHOR,c,d,b);break;case AdvancedSearchController_AS_SEARCH_TYPE_SERIES:a=this.highlightProperty(AdvancedSearchController_DQL_FIELD_SERIES,c,d,b);break;case AdvancedSearchController_AS_SEARCH_TYPE_SUBJECT:a=this.highlightProperty(AdvancedSearchController_DQL_FIELD_SUBJECT,c,d,b);break;case AdvancedSearchController_AS_SEARCH_TYPE_NOTE:a=this.highlightProperty(AdvancedSearchController_DQL_FIELD_NOTE,c,d,b);break;case AdvancedSearchController_AS_SEARCH_TYPE_KEYWORD:default:a=c;break
}}}return a},highlightProperty:function(f,e,d,b){var a="";var c=(b?"(":"");var g=(b?")":"");if(d){a='<span class="queryProperty">'+f+":"+c+"</span>"+e+'</span><span class="queryProperty">'+g+"</span>"}else{a=f+":"+c+e+g}return a},getLineType:function(){return -1},setTabOrder:function(a){this.type.tabIndex=a++;this.textInput.tabIndex=a++;return a}});