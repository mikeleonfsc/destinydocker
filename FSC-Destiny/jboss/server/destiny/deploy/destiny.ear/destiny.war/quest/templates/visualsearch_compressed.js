Class.create(BaseController,{init:function(){DAO.load({endpoint:"VisualSearchController.Contents",container:this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_CONTENT)});this.outerDiv=this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_HIST_DRAWER);this.drawerChest=[];this.addHomeDrawer(MessageHelper.format("visualSearchController_visualSearchHome"));var a=Registry.lookup("MenuBarController.MenuData");a.setViewMode(MenuBarController_VIEW_MODE_VISUAL_SEARCH)},registerEvents:function(){Event.observe(this.elementMap.get(VisualSearchController_LINK_VISUAL_SEARCH_NEXT),"mousedown",this.clickNext.bind(this));Event.observe(this.elementMap.get(VisualSearchController_LINK_VISUAL_SEARCH_PREV),"mousedown",this.clickPrevious.bind(this))},initContent:function(a){this.contents=a;this.elementMap.get(VisualSearchController_DIV_RESULTS_LOADING).hide();this.registerContentEvents()},registerContentEvents:function(){this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_PAGING_MAIN).update("");
if(this.contents.data){var boundDotsListener=this.visualSearchPagingDotsListener.bind(this);for(var i=0;i<this.contents.data.pageCount;i++){var dotElement=Builder.node("a",{onclick:"return false;",id:VisualSearchController_LINK_VISUAL_SEARCH_PAGE_DOT+i,"class":"pageInactive",pageindex:i,alt:eval("this.contents.data.page"+i),title:eval("this.contents.data.page"+i)},[Builder.node("span")]);this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_PAGING_MAIN).insert(dotElement);Event.observe(dotElement,"mousedown",boundDotsListener.curry(i))}if(this.contents.data.pageList){var boundNodeListener=this.visualSearchNodeListener.bind(this);for(var i=0;i<this.contents.data.pageList.length;i++){var node=this.contents.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_NODE+i);Event.observe(node,"click",boundNodeListener.curry(this.contents.data.pageList[i]))}}}},clickNext:function(){if(this.contents){this.hideNextPrevButtons();this.contents.nextPage()}},clickPrevious:function(){if(this.contents){this.hideNextPrevButtons();
this.contents.previousPage()}},hideNextPrevButtons:function(){this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_PAGING_MAIN).setStyle("visibility: hidden");this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_NEXT_BUTTON).hide();this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_PREVIOUS_BUTTON).hide()},showNextButton:function(){this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_NEXT_BUTTON).show()},hideNextButton:function(){this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_NEXT_BUTTON).hide()},showPreviousButton:function(){this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_PREVIOUS_BUTTON).show()},hidePreviousButton:function(){this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_PREVIOUS_BUTTON).hide()},visualSearchPagingDotsListener:function(a){if(this.contents&&this.contents.currentPage!=a){this.hideNextPrevButtons();this.contents.setPage(a)}},visualSearchNodeListener:function(c){var f=c.nodeType;var g=c.nodeID;var l=c.description;
var h=c.imageName;var m=c.nodeType==VisualSearchController_TYPE_ELEMENT_PUBLIC_LIST?c.searchSyntax:null;var a=(c.oneSearchDatabases?true:false);switch(f){case VisualSearchController_TYPE_GROUP:this.addDrawer(h,l,g);this.visualSearchGroupAction(g,l);break;case VisualSearchController_TYPE_ELEMENT_PUBLIC_LIST:var e={width:"",id:ResourceListController_DIV_RESOURCE_LIST_WINDOW,zIndex:"10000",hideOnOutsideClick:"true"};var b=new ModalDialog(e);DAO.load({endpoint:"ResourceListController.Master",modal:b},m,"ResourceList",true);break;case VisualSearchController_TYPE_ELEMENT_CATEGORY:case VisualSearchController_TYPE_ELEMENT_SEARCH:this.setVisualSearchNodeID(g);if(a){var k=Registry.lookup("OneSearchController.SearchMaster");var j={searchText:"",searchType:3,resetOneSearchDatabases:false,visualSearchNodeID:g};k.submitNewSearch(j)}else{var d=Registry.lookup("SearchController.SearchMaster");var j={searchText:"",searchType:1,pageNumber:0,sortBy:SearchController_SORTBYRELEVANCE,didYouMeanSearch:false,hiddenSearch:false,visualSearchNodeID:g,visualSearchType:f};
d.submitNewSearch(j)}break;case VisualSearchController_TYPE_ELEMENT_URL:}},setVisualSearchNodeID:function(a){this.visualSearchNodeID=a},getVisualSearchNodeID:function(){return this.visualSearchNodeID},visualSearchHistoryOverListener:function(a){a.addClassName("activeHistoryRow")},visualSearchHistoryOutListener:function(a){a.removeClassName("activeHistoryRow")},visualSearchHistoryListener:function(d){var a=d.down("a");if(a){var c=a.readAttribute("description");var b=a.readAttribute("groupID");if(this.visualSearchGroupAction(b,c)){this.closeDrawer(a.identify())}}},visualSearchGroupAction:function(b,c){this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_CONTENT).update("");this.elementMap.get(VisualSearchController_DIV_RESULTS_LOADING).show();var a=DAO.load({endpoint:"VisualSearchController.GroupFetcher",container:this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_CONTENT)},b);if(a){this.elementMap.get(VisualSearchController_SPAN_VISUAL_SEARCH_HEADING).update(c)}return a
},visualSearchListClickListener:function(a){this.show();window.currentResourceListID=a.memo.listID;window.currentResourceListName=a.memo.listName.unescapeHTML();this.elementMap.get(VisualSearchController_FIELD_RESOURCE_LIST_PRINT_TITLE).value=a.memo.listName.unescapeHTML();window.VisualSearchController_DIV_RESOURCE_LIST_WINDOW_LIST.showResourceList(a.memo.listID);updateCurrentResourceListTab()},updateVisualSearchDots:function(a){var b=this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_PAGING_MAIN).select("a");for(i=0;i<b.length;i++){b[i].removeClassName("pageInactive");b[i].removeClassName("pageActive");if(a==b[i].readAttribute("pageindex")){b[i].addClassName("pageActive")}else{b[i].addClassName("pageInactive")}}this.elementMap.get(VisualSearchController_DIV_VISUAL_SEARCH_PAGING_MAIN).setStyle("visibility: inherit")},addDrawer:function(d,h,c){var f='<a href="#" class="vsHistoryLink" description="'+h+'"';if(c!=null){f+=' groupID="'+c+'"'}f+=">"+h+"</a>";var e={className:"visualSearchHistoryRow",style:"display: none"};
if(c==null){e=Object.extend({id:"visualSearchHistoryHome"},e)}else{e=Object.extend({id:"visualSearchHistoryNode_"+c},e)}var b=Builder.node("span",{className:"vsHistoryTitleText"});var j=Builder.node("div",e,[Builder.node("img",{className:"vsHistoryThumnail",src:d,height:"40",width:"44",alt:"",title:""}),b]);b.update(MessageHelper.format("visualSearchController_returnTo",f));this.drawerChest[this.drawerChest.length]=j;this.outerDiv.insert({top:j});this.refreshElements();var a=this.elementMap.get(e.id);Event.observe(a,"mousedown",this.visualSearchHistoryListener.bind(this,a));Event.observe(a,"mouseover",this.visualSearchHistoryOverListener.bind(this,a));Event.observe(a,"mouseout",this.visualSearchHistoryOutListener.bind(this,a));if(this.drawerChest.length>1){var g=this.drawerChest[this.drawerChest.length-2];g.show();this.outerDiv.setStyle({top:"-"+g.getHeight()+"px"});new Effect.Move(this.outerDiv,{x:0,y:g.getHeight(),duration:0.5,afterFinish:function(){}})}},closeDrawer:function(b){var e;
var f=[];var g=[];var d=0;var a=false;for(var c=0;c<this.drawerChest.length;c++){if(!a&&this.drawerChest[c].down("a").identify()!=b){f[c]=this.drawerChest[c]}else{if(this.drawerChest[c].visible()){d+=this.drawerChest[c].getHeight()}if(!a){f[c]=this.drawerChest[c];e=this.drawerChest[c]}else{g[g.length]=this.drawerChest[c]}a=true}}new Effect.Move(this.outerDiv,{x:0,y:-d,duration:0.5,afterFinish:this.cleanUpDrawerClose.bind(this,e,g,f)})},cleanUpDrawerClose:function(b,d,c){b.hide();for(var a=0;a<d.length;a++){d[a].remove()}this.outerDiv.setStyle({top:"0px"});this.drawerChest=c;if(this.drawerChest.length==0){this.addHomeDrawer()}},addHomeDrawer:function(a){this.addDrawer("/images/icons/general/spacer.gif",a,null)}});