Class.create(BaseController,{init:function(){if(this.data.activeTab){if(this.data.activeTab==TitleDetailsController_DIV_TITLE_DETAIL_TAB_REVIEWS&&(this.data.titleDetailValue.shelfBib||this.data.titleDetailValue.temporary)){this.setTab(TitleDetailsController_DIV_TITLE_DETAIL_TAB_ADDITIONALINFO)}else{this.setTab(this.data.activeTab)}}else{this.setTab(TitleDetailsController_DIV_TITLE_DETAIL_TAB_ADDITIONALINFO)}if(!this.data.doNotShowDialog){this.modal.show()}if(this.data.bacoEnabled){this.loadSuggestions()}this.shelfSelect=new ShelfSelect({id:"titleDetailsActionButtons",shelfNumber:this.data.shelfNumber});var b=Registry.lookup("TitleDetailsController.DCPITitleDetails");if(b){Registry.unregister("TitleDetailsController.DCPITitleDetails")}if(this.data.canAccessBooklist){DAO.load({endpoint:"BooklistSelectController.TitleDetails",container:this.elementMap.get(BooklistSelectController_SELECT_LIST_CONTAINER)});var a=Registry.lookup("BooklistSelectController.TitleDetails");if(a){a.setBooklistValue(this.data.listID)
}}},registerEvents:function(){Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_TAB_ADDITIONALINFO),"mousedown",this.setTab.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_TAB_ADDITIONALINFO));if(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_TAB_QUIZINFO)!=null){Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_TAB_QUIZINFO),"mousedown",this.setTab.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_TAB_QUIZINFO))}Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_TAB_AWARDS),"mousedown",this.setTab.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_TAB_AWARDS));if(!this.data.titleDetailValue.shelfBib&&!this.data.titleDetailValue.temporary){Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_TAB_REVIEWS),"mousedown",this.setTab.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_TAB_REVIEWS));if(Object.isElement(this.elementMap.get(TitleDetailsController_LINK_TITLE_DETAIL_REVIEWS))){Event.observe(this.elementMap.get(TitleDetailsController_LINK_TITLE_DETAIL_REVIEWS),"mousedown",this.setTab.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_TAB_REVIEWS))
}if(Object.isElement(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_MORE))){Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_MORE),"mousedown",this.titleDetailsShowMoreLessListener.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_MORE))}if(Object.isElement(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_LESS))){Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_LESS),"mousedown",this.titleDetailsShowMoreLessListener.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_LESS))}}Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_CLOSE),"click",this.closeDialog.bind(this));if(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_COVER_CAPTION)){Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_COVER_CAPTION),"mousedown",this.openShelfBrowse.bind(this))
}if(this.data.canSeeRecommendationButton){Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_ADD_RECOMMENDATION),"mousedown",this.openRecommendations.bind(this))}if(!this.data.titleDetailValue.shelfBib&&!this.data.titleDetailValue.temporary&&this.data.bibAssociated&&this.data.canSubmitReviews){if(!this.data.titleDetailValue.reviewForPatron){Event.observe(this.elementMap.get(TitleDetailsController_BUTTON_TITLE_DETAILS_ADD_REVIEW),"mousedown",this.openReviewDialog.bind(this))}}if(this.data.canAddToWishList){Event.observe(this.elementMap.get(TitleDetailsController_BUTTON_TITLE_DETAILS_ADD_TO_WISHLIST_BUTTON),"mousedown",this.openWishDialog.bind(this))}if(this.data.titleDetailValue.canPlaceHold){if(this.data.titleDetailValue.canHoldMultipleCopies){Event.observe(this.elementMap.get(TitleDetailsController_SPAN_HOLD_IT_BUTTON),"mousedown",this.openHoldDialog.bind(this))}else{Event.observe(this.elementMap.get(TitleDetailsController_SPAN_HOLD_IT_BUTTON),"mousedown",this.titleDetailsHoldItListener.bind(this))
}}if(this.data.titleDetailValue.ebookCheckoutState==TitleDetailsController_EBOOK_CHECKOUT_STATE_BLOCKS_EXIST||this.data.titleDetailValue.ebookCheckoutState==TitleDetailsController_EBOOK_CHECKOUT_STATE_AVAILABLE){Event.observe(this.elementMap.get(TitleDetailsController_DIV_EBOOK_CHECKOUT),"mousedown",this.titleDetailsCheckoutEbook.bind(this))}if(this.data.titleDetailValue.follettEBook){if(this.data.canPreviewEbooks&&this.data.titleDetailValue.ebookReadOnlineState==TitleDetailsController_EBOOK_READ_ONLINE_STATE_AVAILABLE){Event.observe(this.elementMap.get(TitleDetailsController_BUTTON_TITLE_DETAILS_PREVIEW_EBOOK),"mousedown",this.titleDetailsPreviewEbook.bind(this))}}if((this.data.titleDetailValue.shelfBib||this.data.titleDetailValue.resoldShelfBib)&&this.data.follettEBookTitleDetailsURL){Event.observe(this.elementMap.get(TitleDetailsController_BUTTON_TITLE_DETAILS_READ_IT),"mousedown",this.titleDetailsReadFollettEbook.bind(this))}if(this.data.showReadItNonFollettEbook){Event.observe(this.elementMap.get(TitleDetailsController_BUTTON_TITLE_DETAILS_READ_IT_NON_FOLLETT),"mousedown",this.titleDetailsReadNonFollettEbook.bind(this))
}if(this.data.canAccessBooklist){Event.observe(this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_ADD_TO_BOOKLIST),"mousedown",this.addTitleToBooklist.bind(this))}for(var a=0;a<this.data.titleDetailValue.quizInfo.readingCounts.length;a++){Event.observe(this.elementMap.get(TitleDetailsController_LINK_TITLE_DETAIL_QUIZ_RC+a),"mousedown",this.setTab.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_TAB_QUIZINFO))}for(var a=0;a<this.data.titleDetailValue.quizInfo.acceleratedReader.length;a++){Event.observe(this.elementMap.get(TitleDetailsController_LINK_TITLE_DETAIL_QUIZ_AR+a),"mousedown",this.setTab.bind(this,TitleDetailsController_DIV_TITLE_DETAIL_TAB_QUIZINFO))}Event.observe(this.modal.contentDiv,"modal:close",this.onClose.bind(this))},loadSuggestions:function(){var a=function(){return DAO.load({endpoint:"TitleDetailsController.Suggestions",container:this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_SUGGESTIONS_CONTENT)},this.data.bibID)};var c=a.bind(this);if(!c()){var b=this.loadSuggestions.bind(this);
b.delay(0.5)}},closeDialog:function(){if(this.modal.visible){this.modal.closeDialog()}},onClose:function(){DAO.load({endpoint:"TitleDetailsController.TabSaver",container:null},this.data.activeTab);var a=Registry.lookup("MyQuestController.Menu");var b=a&&a.isVisible();if(Registry.lookup("SearchTypeController.Selector").getSearchType()!=SearchTypeController_SEARCHTYPE_DCPI&&!b){Registry.lookup("SearchBoxController.SearchBox").focusSearchBox()}},setTab:function(e){this.data.activeTab=e;var a=this.elementMap.get(e);var f=this.elementMap.get(e+TitleDetailsController_DIV_TITLE_DETAIL_TAB_CONTENT);var d=[TitleDetailsController_DIV_TITLE_DETAIL_TAB_ADDITIONALINFO,TitleDetailsController_DIV_TITLE_DETAIL_TAB_QUIZINFO,TitleDetailsController_DIV_TITLE_DETAIL_TAB_AWARDS,TitleDetailsController_DIV_TITLE_DETAIL_TAB_REVIEWS];d=d.without(e);for(var c=0;c<d.length;c++){var b=this.elementMap.get(d[c]+TitleDetailsController_DIV_TITLE_DETAIL_TAB_CONTENT);if(b!=null){b.hide();this.elementMap.get(d[c]).removeClassName("tabActive")
}}a.addClassName("tabActive");f.show()},addTitleToBooklist:function(){this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_ADD_TO_BOOKLIST).hide();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_IN_BOOKLIST).show();var b=(this.data.keywordSearchRecord.digitalMediaProviderName)?SearchTypeController_SEARCHTYPE_DCPI:SearchTypeController_SEARCHTYPE_LIBRARY;var a=DAO.load({endpoint:"BooklistWidgetController.BooklistBookAdder",container:null},this.data.bibID,null,b,null);if(!a){this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_ADD_TO_BOOKLIST).show();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_IN_BOOKLIST).hide()}},updateInUsersBooklist:function(b,a){if(this.data.bibID==a){this.data.titleDetailValue.inUsersBooklist=b;this.data.keywordSearchRecord.inUsersBookList=b}if(b){this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_ADD_TO_BOOKLIST).hide();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_IN_BOOKLIST).show()}else{this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_ADD_TO_BOOKLIST).show();
this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_IN_BOOKLIST).hide()}},openReviewDialog:function(){var b={width:"400px",id:ReviewController_DIV_ADD_REVIEW_DIALOG,zIndex:"50000",hideOnOutsideClick:"true"};var a=new ModalDialog(b);DAO.load({endpoint:"ReviewController.ReviewDialog",modal:a})},openWishDialog:function(){var b={width:"512px",id:WishController_DIV_ADD_WISH_DIALOG,zIndex:"50000",hideOnOutsideClick:"true"};var a=new ModalDialog(b);DAO.load({endpoint:"WishController.WishDialog",modal:a},this.data.bibID,this.data.titleDetailValue.mainTitle)},openHoldDialog:function(){var b={width:"512px",id:HoldController_DIV_ADD_HOLD_DIALOG,zIndex:"50000",hideOnOutsideClick:"true"};var a=new ModalDialog(b);DAO.load({endpoint:"HoldController.HoldDialog",modal:a},this.data.bibID,this.data.titleDetailValue.mainTitle,this.data.titleDetailValue.responsibility,this.data.titleDetailValue.totalHoldableCopies)},openShelfBrowse:function(){var b={width:"700px",height:"300px",id:ShelfBrowseController_DIV_SHELF_BROWSE,zIndex:"30000",hideOnOutsideClick:"true"};
var a=new ModalDialog(b);DAO.load({endpoint:"ShelfBrowseController.ShelfBrowseDialog",modal:a})},updateMyQuestShelf:function(b,a){if(this.data.bibID==a){this.data.shelfNumber=b}},openRecommendations:function(){var b={width:"610px",id:RecommendationController_DIV_ADD_RECOMMENDATION_DIALOG,zIndex:"50000",hideOnOutsideClick:"true"};var a=new ModalDialog(b);DAO.load({endpoint:"RecommendationController.RecommendationDialog",modal:a},this.data.bibID)},titleDetailsShowMoreLessListener:function(a){if(a==TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_MORE){this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_DATA).show();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_LESS).show();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_MORE).hide()}else{if(a==TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_LESS){this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_DATA).hide();
this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_LESS).hide();this.elementMap.get(TitleDetailsController_DIV_TITLE_DETAIL_REVIEWS_WITHOUT_COMMENTS_SHOW_MORE).show()}}},titleDetailsHoldItListener:function(){this.elementMap.get(TitleDetailsController_SPAN_HOLD_IT_BUTTON).hide();var a=DAO.load({endpoint:"TitleDetailsController.Holder",container:null},this.data.bibID);if(!a){this.elementMap.get(TitleDetailsController_SPAN_HOLD_IT_BUTTON).show()}},titleDetailsCheckoutEbook:function(){var d=this.elementMap.get(TitleDetailsController_DIV_EBOOK_CHECKOUT).hide();d.hide();var c={id:"ebookModalDialogModal",zIndex:"30000",hideOnOutsideClick:"true"};var b=new ModalDialog(c);var a=DAO.load({endpoint:"TitleDetailsController.EBookChecker",modal:b},this.data.bibID);if(!a){if(d){d.show()}}},titleDetailsPreviewEbook:function(){var c={id:TitleDetailsController_DIV_PREVIEW_EBOOK_PASSWORD_DIALOG,zIndex:"50000",hideOnOutsideClick:"true"};var b=new ModalDialog(c);this.elementMap.get(TitleDetailsController_BUTTON_TITLE_DETAILS_PREVIEW_EBOOK).disable=true;
var a=DAO.load({endpoint:"TitleDetailsController.PreviewEBookPasswordChecker",modal:b},this.data.bibID);if(!a){this.elementMap.get(TitleDetailsController_BUTTON_TITLE_DETAILS_PREVIEW_EBOOK).disable=false}},titleDetailsReadFollettEbook:function(){var a=window.open(this.data.follettEBookTitleDetailsURL,"shelfcontent_blank");if(a){a.focus()}},titleDetailsReadNonFollettEbook:function(){var a=window.open(this.data.nonFollettEbookURL,"nonfollettebook_blank");if(a){a.focus()}},updateHoldInfo:function(a){this.elementMap.get(TitleDetailsController_SPAN_HOLD_IT_BUTTON).hide();this.elementMap.get("holdInfo").update(a.titleDetailValue.holdHeader+"<br/>"+a.titleDetailValue.holdDetail);this.updateModel(a)},updateMultipleHoldInfo:function(a){this.data.titleDetailValue=a.titleDetailValue;this.data.availabilityText=a.availabilityText;this.data.bibID=a.bibID;this.data.bibAssociated=a.bibAssociated;this.data.availabilityString=a.availabilityString;this.data.availabilityClass=a.availabilityClass;this.data.canPlaceHold=a.canPlaceHold;
this.data.canHoldMultipleCopies=a.canHoldMultipleCopies;this.data.doNotShowDialog=a.doNotShowDialog;this.data.activeTab=a.activeTab;this.refreshPage()},updateModel:function(a){this.pagedData=[a];this.refreshPage()},populateEBookErrorMessage:function(a){this.elementMap.get(TitleDetailsController_DIV_EBOOK_CHECKOUT).update('<p id="titleDetailEbookError">'+a+"</p>");this.elementMap.get(TitleDetailsController_DIV_EBOOK_CHECKOUT).show()},showPreviewEBookButton:function(){this.elementMap.get(TitleDetailsController_BUTTON_TITLE_DETAILS_PREVIEW_EBOOK).disable=false},getBibID:function(){return this.data.bibID},getTitle:function(){return this.data.titleDetailValue.mainTitle},getMiniBibTypeIconURL:function(){return this.data.keywordSearchRecord.miniBibTypeIconURL},getBibTypeDescription:function(){return this.data.keywordSearchRecord.bibTypeDescription},getMaterialType:function(){return this.data.titleDetailValue.materialType},getCallNumberCopyID:function(){return this.data.titleDetailValue.callNumberCopyID
},getCallNumber:function(){return this.data.titleDetailValue.callNumber},updateReviews:function(b,a){this.data.titleDetailValue.reviewInfo=b;this.data.titleDetailValue.reviewForPatron=a;this.refreshPage()},getSuggestionsHoverBoundary:function(){return this.elementMap.get("titleDetails")}});