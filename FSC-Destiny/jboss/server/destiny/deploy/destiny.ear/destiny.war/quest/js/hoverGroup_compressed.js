Class.create({initialize:function(a){this.options=a;this.name=this.options.name;this.hoverMap=this.convertDataToHoverMap(this.options.data);this.activators=this.options.activators;this.controllerURL=this.options.controllerURL;this.templateURL=this.options.templateURL;this.boundActivate=this.activate.bind(this);this.boundDeactivate=this.deactivate.bind(this);this.boundHide=this.hide.bind(this);this.boundShow=this.show.bind(this);this.hoverBoundaryContainer=this.options.hoverContainer;this.onShow=this.options.onShow;this.onHide=this.options.onHide;this.activateEvent=(this.options.activateEvent)?this.options.activateEvent:"mouseover";this.enabled=true;this.openDelay=this.options.openDelay?this.options.openDelay:0;this.closeDelay=this.options.closeDelay?this.options.closeDelay:0;this._buildHovers()},convertDataToHoverMap:function(a){var b=new Hash();if(a&&Object.isArray(a)){a.each(function(c){if(c){if(Object.isArray(c)&&c.length>0&&c[0].hoverKey){b.set(c[0].hoverKey,c)}else{if(c.hoverKey){b.set(c.hoverKey,c)
}}}})}return b},getHoverContainer:function(){if(!this.hoverContainer){this.hoverContainer=new Element("div",{id:this.name});this.hoverContainer.addClassName("hoverContainer");this.hoverContainer.addClassName(HoverMasterController_CLASS_HOVER);this.hoverContainer.setStyle({position:"absolute"})}return this.hoverContainer},_buildHovers:function(){this.hovers=new Hash();this.activators.each(this._addHover.bind(this))},_addHover:function(c){if(c&&Object.isElement(c)){var a=c.readAttribute("hoverKey");var b=new Hover(this.name+"."+a,c,this.hoverBoundaryContainer,this.controllerURL,this.templateURL);this.hovers.set(a,b);b.activatorFunction=this.boundActivate.curry(c,b);b.deactivatorFunction=this.boundDeactivate.curry(c,b);b.close=this.boundHide.curry(c,b);b.showNow=this.boundShow.curry(c,b);Event.observe(c,this.activateEvent,b.activatorFunction);Event.observe(c,"mouseout",b.deactivatorFunction)}},activate:function(c,a,b){if(this.enabled){if(!c){c=this.currentActivator}if(this.closeTimeout){window.clearTimeout(this.closeTimeout)
}if(this.currentActivator!=c||!this.isHoverVisible()||this.getVisibleHoverKey()!=c.readAttribute("hoverKey")){this.currentActivator=c;if(this.openTimeout){window.clearTimeout(this.openTimeout)}this.openTimeout=this.show.bind(this,c,a).delay(this.openDelay)}}},show:function(c,b){if(this.enabled){var e=this.getHoverContainer();Event.stopObserving(e,"mouseover");Event.stopObserving(e,"mouseout");Event.observe(e,"mouseover",b.activatorFunction);Event.observe(e,"mouseout",b.deactivatorFunction);if(this.activateEvent!="mouseover"){Event.observe(c,"mouseover",b.activatorFunction)}var a=c.readAttribute("hoverKey");var d=this.hoverMap.get(a);b.show(e,d,this.options.showEffect,this.options.contentContainer);if(Object.isFunction(this.onShow)){this.onShow(c,b)}}},showHoverNow:function(a){if(this.enabled){var b=this.hovers.get(a);if(b&&Object.isFunction(b.show)){b.showNow()}}},deactivate:function(c,a,b){if(this.openTimeout){window.clearTimeout(this.openTimeout)}if(this.closeTimeout){window.clearTimeout(this.closeTimeout)
}this.closeTimeout=this.hide.bind(this,c,a).delay(this.closeDelay)},hide:function(c,b){var d=this.getHoverContainer();if(!Object.isElement(this.currentActivator)||this.currentActivator==c){this.currentActivator=null;if(this.activateEvent!="mouseover"){Event.stopObserving(c,"mouseover")}if(Object.isFunction(this.options.hideEffect)){var a=$(this.options.contentContainer);if(this.options.contentContainer&&a){this.options.hideEffect(a,d)}}else{d.hide()}if(Object.isFunction(this.onHide)){this.onHide(c,b)}}},dispose:function(){var a=this.hoverContainer;if(Object.isElement(a)&&Object.isElement(a.parentNode)){a.remove()}this.hovers.values().each(this._disposeHover)},getVisibleHoverKey:function(){var b=this.hoverContainer;var a=null;if(Object.isElement(b)&&Object.isElement(b.parentNode)&&b.visible()){a=b.hoverKey}return a},isHoverVisible:function(){var a=this.hoverContainer;return Object.isElement(a)&&Object.isElement(a.parentNode)&&a.visible()},_disposeHover:function(a){a.dispose()},disable:function(){this.enabled=false;
var a=this.hoverContainer;if(Object.isElement(a)&&Object.isElement(a.parentNode)&&a.visible()){a.hide()}},enable:function(){this.enabled=true},getActiveHover:function(){var a=this.getVisibleHoverKey();var b=null;if(a){b=this.hovers.get(a)}return b}});